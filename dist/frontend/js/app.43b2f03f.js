(function(t){function e(e){for(var n,o,r=e[0],l=e[1],c=e[2],u=0,h=[];u<r.length;u++)o=r[u],i[o]&&h.push(i[o][0]),i[o]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);d&&d(e);while(h.length)h.shift()();return s.push.apply(s,c||[]),a()}function a(){for(var t,e=0;e<s.length;e++){for(var a=s[e],n=!0,r=1;r<a.length;r++){var l=a[r];0!==i[l]&&(n=!1)}n&&(s.splice(e--,1),t=o(o.s=a[0]))}return t}var n={},i={app:0},s=[];function o(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=t,o.c=n,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(a,n,function(e){return t[e]}.bind(null,n));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var d=l;s.push([1,"chunk-vendors"]),a()})({0:function(t,e){},"0298":function(t,e,a){},"08ec":function(t,e,a){},1:function(t,e,a){t.exports=a("56d7")},10:function(t,e){},1068:function(t,e,a){"use strict";var n=a("dd4f"),i=a.n(n);i.a},11:function(t,e){},12:function(t,e){},"27c5":function(t,e,a){},2856:function(t,e,a){},"39a5":function(t,e){function a(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}a.keys=function(){return[]},a.resolve=a,t.exports=a,a.id="39a5"},"3c8b":function(t,e,a){},4937:function(t,e,a){"use strict";var n=a("08ec"),i=a.n(n);i.a},"56d7":function(t,e,a){"use strict";a.r(e);var n=a("2b0e"),i=a("5c96"),s=a.n(i),o=(a("0fae"),a("1f54"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("el-container",{staticClass:"orion-main"},[n("el-aside",{attrs:{width:"96px"}},[n("div",{staticClass:"orion-logo-menu"},[n("img",{staticClass:"orion-middle",attrs:{src:a("cf05"),width:"36",height:"36"}})]),n("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":t.activeCourseIndex,collapse:t.isCollapse},on:{select:t.handleNavSelect}},[n("el-menu-item",{attrs:{index:"0"}},[n("i",{staticClass:"fa fa-reddit-alien fa-2x"})]),n("el-menu-item",{attrs:{index:"1"}},[n("i",{staticClass:"el-icon-location"}),n("span",{attrs:{slot:"title"},slot:"title"},[t._v("项目")])]),n("el-menu-item",{attrs:{index:"2"}},[n("i",{staticClass:"el-icon-menu"}),n("span",{attrs:{slot:"title"},slot:"title"},[t._v("社区")])]),n("el-menu-item",{attrs:{index:"3"}},[n("i",{staticClass:"el-icon-document"}),n("span",{attrs:{slot:"title"},slot:"title"},[t._v("设置")])]),n("el-menu-item",{attrs:{index:"4"}},[n("i",{staticClass:"el-icon-setting"}),n("span",{attrs:{slot:"title"},slot:"title"},[t._v("帮助")])]),n("el-menu-item",{attrs:{index:"5"}},[n("i",{staticClass:"el-icon-setting"}),n("span",{attrs:{slot:"title"},slot:"title"},[t._v("关于")])])],1)],1),n("el-container",[n("el-header",[n("el-menu",{staticClass:"el-menu-demo",attrs:{"default-active":t.activeGradeIndex,mode:"horizontal","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"}},[n("el-menu-item",{staticClass:"orion-menu-title",attrs:{id:"orion-gradeclass",index:"0",disabled:""}},[t._v("\n                        "+t._s(t.profile.gradeName)+"\n                    ")])],1),n("el-dropdown",{staticClass:"orion-profile",attrs:{trigger:"click"},on:{command:t.handleCommand}},[n("i",{staticClass:"fa fa-user-circle-o fa-lg",staticStyle:{"margin-right":"15px",color:"white"}},[n("span",{staticStyle:{"margin-left":"8px","font-size":"16px"},attrs:{id:"orion-username"}},[t._v(t._s(t.profile.name))])]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"student"}},[t._v("新用户注册")]),n("el-dropdown-item",{attrs:{command:"student",divided:""}},[t._v("用户信息")]),n("el-dropdown-item",{attrs:{command:"mine"}},[t._v("我的积分")]),n("el-dropdown-item",{attrs:{command:"quit",divided:""}},[t._v("退出")])],1)],1)],1),n("el-main",[t.isRouterAlive?n("router-view"):t._e()],1),n("el-footer",[n("h4",[n("span",{staticClass:"orion-version"},[t._v(t._s(t.appTitle))]),t._v(t._s(t.copyright))])])],1)],1),n("el-dialog",{attrs:{title:"学生信息",visible:t.dialogInfoVisible},on:{"update:visible":function(e){t.dialogInfoVisible=e}}},[n("el-form",{attrs:{model:t.form,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"姓名"}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),n("el-form-item",{attrs:{label:"班号"}},[n("el-input-number",{attrs:{step:1,min:1,max:10},model:{value:t.form.class,callback:function(e){t.$set(t.form,"class",e)},expression:"form.class"}})],1),n("el-form-item",{attrs:{label:"教材类型"}},[n("el-radio-group",{model:{value:t.form.source,callback:function(e){t.$set(t.form,"source",e)},expression:"form.source"}},[t._l(t.sourceItems,function(e){return[n("el-radio",{attrs:{label:e.id}},[t._v(t._s(e.name))])]})],2)],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.dialogInfoVisible=!1}}},[t._v("取 消")]),n("el-button",{attrs:{type:"primary"}},[t._v("修 改")])],1)],1),n("el-dialog",{attrs:{title:"身份确认",visible:t.dialogAuthVisible,width:"30%"},on:{"update:visible":function(e){t.dialogAuthVisible=e}}},[n("el-form",{attrs:{model:t.authForm,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"管理员口令",prop:"pwd",rules:{required:!0,message:"密码不能为空",trigger:"blur"}}},[n("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:t.authForm.pwd,callback:function(e){t.$set(t.authForm,"pwd",e)},expression:"authForm.pwd"}})],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.dialogAuthVisible=!1}}},[t._v("取 消")]),n("el-button",{attrs:{type:"primary"}},[t._v("确 定")])],1)],1)],1)}),r=[],l=a("bbbc");const c=["off","error","warn","info","log","debug"];let d={};function u(){c.forEach(t=>{const e=c.indexOf(t);d[t]={},c.forEach(a=>{const n=c.indexOf(a);n<=e&&(d[t][a]=!0)})})}u();let h="log";function p(t){let e=h||"log";return d[e]&&d[e][t]}const m={setLevel:t=>{h=t||"log"},debug:(...t)=>{p("debug")&&console.debug.apply(console,t)},log:(...t)=>{p("log")&&console.log.apply(console,t)},info:(...t)=>{p("info")&&console.info.apply(console,t)},warn:(...t)=>{p("warn")&&console.warn.apply(console,t)},error:(...t)=>{p("error")&&console.error.apply(console,t)}};var g=m;let f={global:void 0,isDef:function(t){return void 0!==t},isString:function(t){return"string"===typeof t},isBoolean:function(t){return"boolean"===typeof t},isNumber:function(t){return"number"===typeof t},getObjectByName:function(t,e){let a=t.split("."),n=e||f.global;for(let i=0;i<a.length;i++)if(n=n[a[i]],!f.isDefAndNotNull(n))return null;return n},logToConsole_:function(t){f.global.console&&f.global.console["error"](t)},nullFunction:function(){},abstractMethod:function(){throw new Error("unimplemented abstract method")},typeOf:function(t){let e=typeof t;if("object"===e){if(!t)return"null";{if(t instanceof Array)return"array";if(t instanceof Object)return e;let a=Object.prototype.toString.call(t);if("[object Window]"===a)return"object";if("[object Array]"===a||"number"===typeof t.length&&"undefined"!==typeof t.splice&&"undefined"!==typeof t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"===a||"undefined"!==typeof t.call&&"undefined"!==typeof t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}}else if("function"===e&&"undefined"===typeof t.call)return"object";return e},isNull:function(t){return null==t},isDefAndNotNull:function(t){return null!=t},isArray:function(t){return"array"===f.typeOf(t)},isArrayLike:function(t){var e=f.typeOf(t);return"array"===e||"object"===e&&"number"===typeof t.length},isFunction:function(t){return"function"===f.typeOf(t)},isObject:function(t){var e=typeof t;return"object"===e&&null!=t||"function"===e},cloneObject:function(t){var e=f.typeOf(t);if("object"===e||"array"===e){if(t.clone)return t.clone();var a="array"===e?[]:{};for(var n in t)a[n]=f.cloneObject(t[n]);return a}return t},inherits:function(t,e){function a(){}a.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new a,t.prototype.constructor=t,t.base=function(t,a,n){for(var i=new Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[a].apply(t,i)}},strByteLength:function(t){var e=t.match(/[^\x00-\xff]/gi);return t.length+(null==e?0:e.length)},trimString:function(t){return t.replace(/^\s+|\s+$/g,"")},concatArray:function(t,e){var a=t.concat(e);return Array.from(new Set(a))}};const y=["零","一","二","三","四","五"," 六","七","八","九","十","百","千","万"];f.number2String=function(t){return f.isNumber(t)&&t<10?y[t]:""},f.randomSort=function(t,e){return Math.random()>.5?-1:1},f.shuffle=function(t){for(var e=t.length,a=0;a<e-1;a++){var n=Math.floor(Math.random()*(e-a)),i=t[n];t[n]=t[e-a-1],t[e-a-1]=i}return t},f.randomString=function(t){t=t||32;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=e.length,n="",i=0;i<t;i++)n+=e.charAt(Math.floor(Math.random()*(a+1)));return n},f.currentTimeString=function(){let t=new Date;const e=t.getFullYear(),a=t.getMonth()+1,n=t.getDate();return e+"-"+a+"-"+n},f.dateCompare=function(t,e){let a=new Date(t),n=new Date(e);return a.getTime()>n.getTime()?1:a.getTime()<n.getTime()?-1:0},f.randomNumber=function(t,e=0){return Math.floor(Math.random()*(t-e+1)+e)};var b=f,v=a("3452"),x=a.n(v),k=a("1157"),w=a.n(k);const _=!0;function B(){return _?"http://localhost:7781":"https://orion6.uorion.com"}const z={sha256:function(t){return x.a.SHA256(t).toString(x.a.enc.Hex)},ajaxPost:function(t){w.a.ajax({url:B()+t.url,type:"POST",data:{data:JSON.stringify(t.data)},dataType:"json",success:function(e){t.success(e)}})},ajaxGet:function(t){w.a.ajax({url:B()+t.url,type:"GET",dataType:"json",success:function(e){t.success(e)}})}};var C=z;g.setLevel("debug");var $={components:{ElContainer:l["a"]},data(){return{appTitle:"",copyright:"",activeCourseIndex:"0",isCollapse:!1,dialogInfoVisible:!1,profile:{name:"",class:1,gradeName:"",source:"rj"},form:{name:"",class:1,source:"rj"},isRouterAlive:!0,dialogAuthVisible:!1,authForm:{pwd:""}}},computed:{sourceItems:function(){return this.$store.getters.sourceItems}},methods:{handleNavSelect(t,e){console.log(t,e),this.activeCourseIndex=t;let a={};"0"===this.activeCourseIndex?a.name="welcome":a.name="editor",this.$router.push(a)},updateFooter(){const t=this.$store.state;this.appTitle=this.$store.getters.appTitle,this.copyright=`@2018 ${t.company} 版权所有`},handleCommand(t){if("student"===t)this.form.name=this.profile.name,this.form.class=this.profile.class,this.form.source=this.profile.source,this.dialogInfoVisible=!0;else if("mine"===t){if("mine"===this.$router.history.current.name)return;this.$router.push({name:"mine"})}else if("score"===t){if("score"===this.$router.history.current.name)return;this.authForm.pwd="",this.dialogAuthVisible=!0}},reload(){this.isRouterAlive=!1,this.$nextTick(function(){this.isRouterAlive=!0})}},created:function(){this.updateFooter()},mounted:function(){C.ajaxGet({url:"/api/v1/manifest",success:t=>{0==t.result?(this.$store.commit("updateManifest",t.content),this.updateFooter()):this.$message.error("读取配置信息失败，请退出重试")}}),this.$router.push({name:"welcome"})}},S=$,H=(a("5c0b"),a("2877")),N=Object(H["a"])(S,o,r,!1,null,null,null);N.options.__file="App.vue";var A=N.exports,j=a("8c4f"),P=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"})},T=[],D={data:function(){return{}},mounted:function(){}},I=D,O=(a("9a9e"),Object(H["a"])(I,P,T,!1,null,"37473401",null));O.options.__file="Welcome.vue";var F=O.exports,R=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("el-tabs",{attrs:{"tab-position":"left"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"场景",name:"scene"}}),a("el-tab-pane",{attrs:{label:"脚本",name:"script"}},[a("Scratch",{attrs:{flex:"1",savebtn:t.save,loadbtn:t.load,export:t.openExportDialog}}),a("input",{attrs:{id:"yuchang-save",type:"file"}}),a("el-dialog",{attrs:{title:"保存脚本",visible:t.dialogVisible,height:"200px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{attrs:{model:t.form}},[a("el-form-item",{attrs:{label:"文件名","label-width":"80px"}},[a("el-col",{attrs:{span:20}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),a("el-col",{staticClass:"yuchang-ext",attrs:{span:4}},[t._v(t._s(t.form.ext))])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.callbackSaveFile}},[t._v("确 定")])],1)],1)],1),a("el-tab-pane",{attrs:{label:"动画",name:"animation"}},[t._v("动画")]),a("el-tab-pane",{attrs:{label:"素材",name:"gallery"}},[t._v("素材")]),a("el-tab-pane",{attrs:{label:"预览",name:"preview"}},[t._v("预览")])],1)],1)},E=[],W=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"scratch",staticStyle:{position:"relative"},attrs:{id:t.id,onselectstart:"return false",oncontextmenu:"return false"}},[a("svg",{staticClass:"ycBlockSvg",attrs:{width:t.size.width,height:t.size.height,version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[a("defs",[a("pattern",{attrs:{id:"ycBlockGridPattern",patternUnits:"userSpaceOnUse",width:"38.879999999999995",height:"38.879999999999995",x:"207.0918124072559",y:"-1.856000000001302"}},[a("line",{attrs:{stroke:"#ddd","stroke-width":"0.972",x1:"18.954",y1:"19.926",x2:"20.898",y2:"19.926"}}),a("line",{attrs:{stroke:"#ddd","stroke-width":"0.972",x1:"19.926",y1:"18.954",x2:"19.926",y2:"20.898"}})]),a("filter",{attrs:{id:"ycBlockReplacementGlowFilter",height:"160%",width:"180%",y:"-30%",x:"-40%"}},[a("feGaussianBlur",{attrs:{in:"SourceGraphic",stdDeviation:"2"}}),a("feComponentTransfer",{attrs:{result:"outBlur"}},[a("feFuncA",{attrs:{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"}})],1),a("feFlood",{attrs:{"flood-color":"#FFFFFF","flood-opacity":"1",result:"outColor"}}),a("feComposite",{attrs:{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"}}),a("feComposite",{attrs:{in:"SourceGraphic",in2:"outGlow",operator:"over"}})],1),a("filter",{attrs:{id:"ycBlockStackGlowFilter",height:"160%",width:"180%",y:"-30%",x:"-40%"}},[a("feGaussianBlur",{attrs:{in:"SourceGraphic",stdDeviation:"4"}}),a("feComponentTransfer",{attrs:{result:"outBlur"}},[a("feFuncA",{attrs:{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"}})],1),a("feFlood",{attrs:{"flood-color":"#FFF200","flood-opacity":"1",result:"outColor"}}),a("feComposite",{attrs:{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"}}),a("feComposite",{attrs:{in:"SourceGraphic",in2:"outGlow",operator:"over"}})],1)]),a("g",{staticClass:"ycBlockWorkspace"},[a("rect",{staticClass:"ycBlockMainBackground",staticStyle:{fill:"url(#ycBlockGridPattern)"},attrs:{height:"100%",width:"100%"}}),a("text",{staticClass:"ycBlockText",attrs:{id:"ycBlockInfo",y:"2","text-anchor":"middle","dominant-baseline":"middle",dy:"0",x:"8",transform:"translate(128, 24) "}},[t._v("X: 0  Y: 0")]),a("g",{staticClass:"ycBlockCanvas"})]),a("g",{staticClass:"ycBlockButtons",attrs:{transform:"translate(20,20)"}})]),a("svg",{staticClass:"ycBlockDragSurface",staticStyle:{display:"block"},attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg"}},[a("g",{staticClass:"ycBlockDragCanvas",attrs:{filter:"url(#ycBlockDragShadowFilter)"}}),a("defs",[a("filter",{attrs:{id:"ycBlockDragShadowFilter",height:"140%",width:"140%",y:"-20%",x:"-20%"}},[a("feGaussianBlur",{attrs:{in:"SourceAlpha",stdDeviation:"6"}}),a("feComponentTransfer",{attrs:{result:"offsetBlur"}},[a("feFuncA",{attrs:{type:"linear",slope:"0.6"}})],1),a("feComposite",{attrs:{in:"SourceGraphic",in2:"offsetBlur",operator:"over"}})],1)])]),a("svg",{staticClass:"ycBlockWsDragSurface ycBlockOverflowVisible",staticStyle:{display:"none"},attrs:{width:t.size.width,height:t.size.height,version:"1.1",xmlns:"http://www.w3.org/2000/svg"}}),a("svg",{staticClass:"ycBlockFlyout",attrs:{width:t.flyout.width,height:t.size.height}},[a("defs",[a("clipPath",{attrs:{id:"ycBlockMenuClipPath"}},[a("rect",{attrs:{id:"ycBlockMenuClipRect",height:t.size.height,width:t.flyout.width,y:"0",x:"0"}})])]),a("path",{staticClass:"ycBlockFlyoutBackground",attrs:{d:t.flyoutBackground}}),a("g",{staticClass:"ycBlockWorkspace",attrs:{"clip-path":"url(#ycBlockMenuClipPath)"}},[a("g",{staticClass:"ycBlockCanvas"},[a("rect",{attrs:{"fill-opacity":"0",x:"12",y:"1960",height:"56",width:"96"}})]),a("g",{staticClass:"ycBlockBubbleCanvas"})])]),a("div",{staticClass:"ycBlockToolbox",staticStyle:{direction:"ltr"},attrs:{height:t.size.height}},[a("div",{staticClass:"ycBlockCategoryMenu"})]),a("div",{staticClass:"ycBlockWidgetDiv"}),t._m(0),a("div",{staticClass:"ycBlockTooltipDiv"})])},M=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ycBlockDropDownDiv"},[a("div",{staticClass:"ycBlockDropDownContent"}),a("div",{staticClass:"ycBlockDropDownArrow"})])}],V=a("5698"),L={internal:{name:"内部",display:"none",state:{background:{stroke:"#000000",fill:"#000000",opacity:"0.2"}}},sensing:{name:"感知",state:{background:{stroke:"#2E8EB8",fill:"#5CB1D6",opacity:"1"}}},motion:{name:"运动",state:{background:{stroke:"#3373CC",fill:"#4C97FF",opacity:"1"}}},event:{name:"事件",state:{background:{stroke:"#CC9900",fill:"#FFBF00",opacity:"1"}}},control:{name:"控制",state:{background:{stroke:"#CF8B17",fill:"#FFAB19",opacity:"1"}}},operator:{name:"运算",state:{background:{stroke:"#389438",fill:"#59C059",opacity:"1"}}},data:{name:"数据",state:{background:{stroke:"#DB6E00",fill:"#FF8C1A",opacity:"1"}}},presentation:{name:"外观",state:{background:{stroke:"#774DCB",fill:"#9966FF",opacity:"1"}}},media:{name:"多媒体",state:{background:{stroke:"#BD42BD",fill:"#CF63CF",opacity:"1"}}},custom:{name:"自定义",state:{background:{stroke:"#FF3355",fill:"#FF6680",opacity:"1"}}}},G=[{id:"locationx",name:"X坐标",shape:"round",category:"sensing",draggable:!0,state:{data:{datatype:"number",text:"X坐标"}},exports:{json:function(t){return{}}}},{id:"locationy",name:"Y坐标",shape:"round",category:"sensing",draggable:!0,state:{data:{datatype:"number",text:"Y坐标"}},exports:{json:function(t){return{}}}},{id:"origin",name:"是否在原点",shape:"diamond",category:"sensing",draggable:!0,state:{data:{datatype:"boolean",text:"是否在原点"}},exports:{json:function(t){return{}}}}],q=[{id:"submarine",name:"潜艇",shape:"round",category:"sensing",draggable:!0,state:{data:{datatype:"string",text:"潜艇"}},exports:{json:function(t){return{}}}},{id:"ship",name:"水面船只",shape:"round",category:"sensing",draggable:!0,state:{data:{datatype:"string",text:"水面船只"}},exports:{json:function(t){return{}}}}];let U=[];U=U.concat(G,q);var Y=U,X=[{id:"insertmarker",name:"插入标记",shape:"none",category:"internal",draggable:!0,exports:{json:function(t){return{}}}}];let Z=[];Z=Z.concat(X);var J=Z,Q=[{id:"move",shape:"slot",category:"motion",draggable:!0,state:{data:{sections:[{type:"text",text:"移动"},{type:"argument",datatype:"number",data:{value:1}},{type:"text",text:"步"}]}},exports:{json:function(t){return{}}}},{id:"steer",shape:"slot",category:"motion",draggable:!0,state:{data:{sections:[{type:"text",text:"转向到"},{type:"argument",datatype:"number",data:{value:1}},{type:"text",text:"度"}]}},exports:{json:function(t){return{}}}},{id:"movedestination",shape:"slot",category:"motion",draggable:!0,state:{data:{sections:[{type:"text",text:"设置航行目标为"},{type:"argument",datatype:"number",data:{value:0}},{type:"argument",datatype:"number",data:{value:0}}]}},exports:{json:function(t){return{}}}},{id:"sleep",shape:"slot",category:"control",draggable:!0,state:{data:{sections:[{type:"text",text:"等待"},{type:"argument",datatype:"number",data:{value:1}},{type:"text",text:"秒"}]}},exports:{json:function(t){return{}}}}],K=[{id:"interference",shape:"slot",category:"motion",draggable:!0,state:{data:{sections:[{type:"text",text:"将干扰器"},{type:"argument",datatype:"enum",data:{currentIndex:0,values:[{name:"关闭",value:0},{name:"打开",value:1}]}}]}},exports:{json:function(t){return{}}}}],tt=[{id:"playaudio",shape:"slot",category:"media",draggable:!0,state:{data:{sections:[{type:"text",text:"将背景音乐"},{type:"argument",datatype:"enum",data:{currentIndex:0,values:[{name:"关闭",value:0},{name:"打开",value:1}]}}]}},exports:{json:function(t){return{}}}}],et=[{id:"execute",shape:"slot",category:"control",draggable:!0,state:{data:{sections:[{type:"text",text:"执行命令"},{type:"argument",datatype:"string"}]}},exports:{json:function(t){return{}}}}];let at=[];at=at.concat(Q,K,tt,et);var nt=at,it=[{id:"click",shape:"cap",category:"event",draggable:!0,begin:!0,state:{data:{sections:[{type:"text",text:"当"},{type:"image",url:"/img/green-flag.svg",width:24,height:24},{type:"text",text:"被点击"}]}},exports:{json:function(t){return{}}}},{id:"detect",shape:"cap",category:"event",draggable:!0,begin:!0,state:{data:{sections:[{type:"text",text:"当探测到"},{type:"argument",datatype:"string"},{type:"text",text:"时"}]}},exports:{json:function(t){return{}}}}],st=[{id:"commanddefine",shape:"hat",category:"event",draggable:!0,begin:!0,state:{data:{sections:[{type:"text",text:"定义命令"},{type:"argument",datatype:"string"}]}},exports:{json:function(t){return{}}}}];let ot=[];ot=ot.concat(it,st);var rt=ot,lt=[{id:"add",name:"相加",shape:"round",category:"operator",draggable:!0,state:{size:{padding:4},data:{datatype:"number",sections:[{type:"argument",datatype:"number"},{type:"text",text:"+"},{type:"argument",datatype:"number"}]}},exports:{json:function(t){return{}}}},{id:"minus",name:"相减",shape:"round",category:"operator",draggable:!0,state:{size:{padding:4},data:{datatype:"number",sections:[{type:"argument",datatype:"number"},{type:"text",text:"-"},{type:"argument",datatype:"number"}]}},exports:{json:function(t){return{}}}},{id:"divide",name:"相除",shape:"round",category:"operator",draggable:!0,state:{size:{padding:4},data:{datatype:"number",sections:[{type:"argument",datatype:"number"},{type:"text",text:"/"},{type:"argument",datatype:"number"}]}},exports:{json:function(t){return{}}}},{id:"multiply",name:"相乘",shape:"round",category:"operator",draggable:!0,state:{size:{padding:4},data:{datatype:"number",sections:[{type:"argument",datatype:"number"},{type:"text",text:"✖"},{type:"argument",datatype:"number"}]}},exports:{json:function(t){return{}}}},{id:"logicadd",name:"逻辑与",shape:"diamond",category:"operator",draggable:!0,state:{size:{padding:{left:8,right:8,top:4,bottom:4}},data:{datatype:"boolean",sections:[{type:"argument",datatype:"boolean"},{type:"text",text:"与"},{type:"argument",datatype:"boolean"}]}},exports:{json:function(t){return{}}}},{id:"logicor",name:"逻辑或",shape:"diamond",category:"operator",draggable:!0,state:{size:{padding:{left:8,right:8,top:4,bottom:4}},data:{datatype:"boolean",sections:[{type:"argument",datatype:"boolean"},{type:"text",text:"或"},{type:"argument",datatype:"boolean"}]}},exports:{json:function(t){return{}}}},{id:"greater",name:"大于",shape:"diamond",category:"operator",draggable:!0,state:{size:{padding:{left:16,right:16,top:4,bottom:4}},data:{datatype:"boolean",sections:[{type:"argument",datatype:"number"},{type:"text",text:"大于"},{type:"argument",datatype:"number"}]}},exports:{json:function(t){return{}}}},{id:"less",name:"小于",shape:"diamond",category:"operator",draggable:!0,state:{size:{padding:{left:16,right:16,top:4,bottom:4}},data:{datatype:"boolean",sections:[{type:"argument",datatype:"number"},{type:"text",text:"小于"},{type:"argument",datatype:"number"}]}},exports:{json:function(t){return{}}}},{id:"equal",name:"等于",shape:"diamond",category:"operator",draggable:!0,state:{size:{padding:{left:16,right:16,top:4,bottom:4}},data:{datatype:"boolean",sections:[{type:"argument",datatype:"number"},{type:"text",text:"等于"},{type:"argument",datatype:"number"}]}},exports:{json:function(t){return{}}}}],ct=[{id:"camp",name:"阵营选择器",shape:"round",category:"operator",draggable:!0,state:{size:{padding:4},data:{datatype:"string",sections:[{type:"argument",datatype:"enum",data:{currentIndex:0,values:[{name:"白方",value:0},{name:"红方",value:1},{name:"蓝方",value:2}]}},{type:"text",text:"的"},{type:"argument",datatype:"string"}]}},exports:{json:function(t){return{}}}}];let dt=[];dt=dt.concat(lt,ct);var ut=dt,ht=[{id:"forever",shape:"cup",category:"control",end:!0,draggable:!0,state:{data:{sections:[{type:"text",text:"重复执行"}],subscript:{url:"/img/repeat.svg",width:24,height:24}}},exports:{json:function(t){return{}}}},{id:"while",shape:"cup",category:"control",draggable:!0,state:{data:{sections:[{type:"text",text:"重复执行直到"},{type:"argument",datatype:"boolean"}],subscript:{url:"/img/repeat.svg",width:24,height:24}}},exports:{json:function(t){return{}}}},{id:"for",shape:"cup",category:"control",end:!1,draggable:!0,state:{data:{sections:[{type:"text",text:"重复执行"},{type:"argument",datatype:"number",data:{value:1}},{type:"text",text:"次"}],subscript:{url:"/img/repeat.svg",width:24,height:24}}},exports:{json:function(t){return{}}}}],pt=[{id:"if",shape:"cup",category:"control",end:!1,draggable:!0,state:{data:{sections:[{type:"text",text:"如果"},{type:"argument",datatype:"boolean"},{type:"text",text:"那么"}]}},exports:{json:function(t){return{}}}},{id:"ifelse",shape:"cuptwo",category:"control",end:!1,draggable:!0,state:{data:{sections:[{type:"text",text:"如果"},{type:"argument",datatype:"boolean"},{type:"text",text:"那么"}],other:{type:"text",text:"否则"}}},exports:{json:function(t){return{}}}}];let mt=[];mt=mt.concat(ht,pt);var gt=mt,ft={variant:Y,marker:J,action:nt,event:rt,express:ut,control:gt},yt=[{id:"yonger",type:"event",shape:"cap",category:"data",draggable:!0,state:{data:{sections:[{type:"text",text:"《咏鹅》"}]}},exports:{json:function(t){return{}}}},{id:"yonger@1",type:"action",shape:"slot",category:"data",draggable:!0,state:{data:{sections:[{type:"text",text:"鹅鹅鹅，"}]}},exports:{json:function(t){return{}}}},{id:"yonger@2",type:"action",shape:"slot",category:"data",draggable:!0,state:{data:{sections:[{type:"argument",datatype:"string"},{type:"text",text:"向天歌。"}]}},exports:{json:function(t){return{}}}},{id:"yonger@3",type:"action",shape:"slot",category:"data",draggable:!0,state:{data:{sections:[{type:"text",text:"白毛"},{type:"argument",datatype:"string"},{type:"text",text:"绿水，"}]}},exports:{json:function(t){return{}}}},{id:"yonger@4",type:"action",shape:"slot",category:"data",draggable:!0,end:!0,state:{data:{sections:[{type:"text",text:"红掌拨"},{type:"argument",datatype:"string"},{type:"text",text:"。"}]}},exports:{json:function(t){return{}}}}];let bt=[];bt=bt.concat(yt);var vt=bt;let xt=[];xt=xt.concat(vt);var kt=xt,wt=[{id:"keras-model",type:"event",shape:"cap",category:"custom",draggable:!0,state:{data:{sections:[{type:"text",text:"定义模型"},{type:"argument",datatype:"enum",data:{currentIndex:0,values:[{name:"Sequential",value:0}]}}]}}},{id:"keras-dense-simple",type:"action",shape:"slot",category:"custom",draggable:!0,state:{data:{sections:[{type:"text",text:"Dense"},{type:"argument",datatype:"number",data:{value:1}}]}}},{id:"keras-dense",type:"control",shape:"cup",category:"custom",draggable:!0,state:{data:{sections:[{type:"text",text:"Dense"},{type:"argument",datatype:"number",data:{value:1}}]}}},{id:"keras-activation-simple",type:"action",shape:"slot",category:"custom",draggable:!0,state:{data:{sections:[{type:"text",text:"Activation"},{type:"argument",datatype:"enum",data:{currentIndex:0,values:[{name:"softmax",value:1},{name:"elu",value:2},{name:"selu",value:3},{name:"softplus",value:4},{name:"softsign",value:5},{name:"relu",value:6},{name:"tanh",value:7},{name:"sigmoid",value:8},{name:"hard_sigmoid",value:9},{name:"exponential",value:10},{name:"linear",value:11}]}}]}}},{id:"keras-dropout-simple",type:"action",shape:"slot",category:"custom",draggable:!0,state:{data:{sections:[{type:"text",text:"Dropout"},{type:"argument",datatype:"number",data:{value:.5}}]}}},{id:"keras-conv1d-simple",type:"action",shape:"slot",category:"custom",draggable:!0,state:{data:{sections:[{type:"text",text:"Conv1D"},{type:"argument",datatype:"number",data:{value:1}}]}}},{id:"keras-conv2d-simple",type:"action",shape:"slot",category:"custom",draggable:!0,state:{data:{sections:[{type:"text",text:"Conv2D"},{type:"argument",datatype:"number",data:{value:1}}]}}},{id:"keras-param-string",type:"action",shape:"slot",category:"custom",draggable:!0,state:{size:{padding:{left:4,right:4,top:4,bottom:4}},data:{datatype:"string",sections:[{type:"text",text:"设置参数"},{type:"argument",datatype:"enum",data:{currentIndex:0,values:[{name:"padding",value:0},{name:"data_format",value:1}]}},{type:"text",text:"="},{type:"argument",datatype:"string"}]}}},{id:"keras-param-number",type:"action",shape:"slot",category:"custom",draggable:!0,state:{size:{padding:{left:4,right:4,top:4,bottom:4}},data:{datatype:"string",sections:[{type:"text",text:"设置参数"},{type:"argument",datatype:"enum",data:{currentIndex:0,values:[{name:"kernel_size",value:0},{name:"strides",value:1},{name:"dilation_rate",value:1}]}},{type:"text",text:"="},{type:"argument",datatype:"number"}]}}},{id:"keras-param-number2",type:"action",shape:"slot",category:"custom",draggable:!0,state:{data:{sections:[{type:"text",text:"设置参数"},{type:"argument",datatype:"enum",data:{currentIndex:0,values:[{name:"input_shape",value:0}]}},{type:"text",text:"="},{type:"argument",datatype:"number"},{type:"argument",datatype:"number"}]}}},{id:"keras-kernelsize",type:"action",shape:"slot",category:"custom",draggable:!0,state:{data:{sections:[{type:"text",text:"kernel_size ="},{type:"argument",datatype:"number"},{type:"argument",datatype:"number"}]}}},{id:"keras-param-bool",type:"action",shape:"slot",category:"custom",draggable:!0,state:{data:{sections:[{type:"text",text:"设置参数"},{type:"argument",datatype:"enum",data:{currentIndex:0,values:[{name:"use_bias",value:0}]}},{type:"text",text:"="},{type:"argument",datatype:"enum",data:{currentIndex:0,values:[{name:"True",value:1},{name:"False",value:0}]}}]}}}];let _t=[];_t=_t.concat(wt);var Bt=_t;let zt=1;function Ct(){return zt++}var $t=[{id:"mk-flow",type:"event",shape:"cap",category:"presentation",draggable:!0,begin:!0,state:{data:{sections:[{type:"text",text:"MarkDown 流程图"}]}},export:[{menuItem:!0,menuName:"导出为MarkDown",fmt:"markdown",ext:".md",action:function(){const t="markdown";let e=this.nextBlock();"mk-flow-start"!==e.protoId()&&g.warn("MarkDown Export: first block is not <start> Block");let a={},n={},i=[],s=[],o=!1,r="";const l=(t,e)=>{if(n[t.uid])return n[t.uid];let a=t.export(e);return a=c(a),a&&(n[t.uid]=a),a},c=t=>{return t?(t.index>0?a[t.index]?(a[t.index].type!==t.type&&(o=!0,r=`导出失败: MarkDown Export failed: index [${t.index}] has different type`),t=a[t.index]):(a[t.index]=t,i.push(t.def)):i.push(t.def),t):null},d=(e,a,n=[])=>{let i=[];n.length>0&&i.push(n);let r=e;while(r){let e=l(r,t);if(e){if("c"===e.type){i.push(e.name);let t=r.nextBlock();d(t);let a=r.resolveBlock();a&&d(a,t,[e.yes]);let n=r.rejectBlock();n&&d(n,t,[e.no]);break}i.push(e.cell)}if(o)break;r=r.nextBlock()}if(a){let t=l(a);i.push(t.name)}i.length>0&&s.push(i.join("->"))};if(d(e),o)return r;let u="";return u+=i.join("\n"),u+="\n",u+=s.reverse().join("\n"),u}}]},{id:"mk-flow-start",type:"action",shape:"slot",category:"presentation",draggable:!0,state:{data:{sections:[{type:"text",text:"START"},{type:"argument",datatype:"number"},{type:"text",text:"TAG"},{type:"argument",datatype:"string",data:{value:"开始"}},{type:"text",text:"URL"},{type:"argument",datatype:"string"}]}},export:[{fmt:"markdown",ext:".md",action:function(){let t={type:"st",index:0,name:"",def:"",cell:""};t.name=t.type+Ct(),t.index=this.sectionValue(1);let e=this.sectionValue(3);t.def=`${t.name}=>start: ${e}`;let a=this.sectionValue(5);return a.length>0&&(t.def+=`:> ${a}`),t.cell=`${t.name}`,t}}]},{id:"mk-flow-end",type:"action",shape:"slot",category:"presentation",draggable:!0,end:!0,state:{data:{sections:[{type:"text",text:"END"},{type:"argument",datatype:"number"},{type:"text",text:"TAG"},{type:"argument",datatype:"string",data:{value:"结束"}}]}},export:[{fmt:"markdown",ext:".md",action:function(){let t={type:"e",index:0,name:"",def:"",cell:""};t.name=t.type+Ct(),t.index=this.sectionValue(1);let e=this.sectionValue(3);return t.def=`${t.name}=>end: ${e}`,t.cell=`${t.name}`,t}}]},{id:"mk-flow-operation",type:"action",shape:"slot",category:"presentation",draggable:!0,state:{data:{sections:[{type:"text",text:"OP"},{type:"argument",datatype:"number"},{type:"text",text:"TAG"},{type:"argument",datatype:"string",data:{value:"程序"}},{type:"text",text:"URL"},{type:"argument",datatype:"string"},{type:"argument",datatype:"enum",data:{currentIndex:3,values:[{name:"left",value:0},{name:"top",value:1},{name:"right",value:2},{name:"bottom",value:3}]}}]}},export:[{fmt:"markdown",ext:".md",action:function(){let t={type:"op",index:0,name:"",def:"",cell:""};t.name=t.type+Ct(),t.index=this.sectionValue(1);let e=this.sectionValue(3);t.def=`${t.name}=>operation: ${e}`;let a=this.sectionValue(5);a.length>0&&(t.def+=`:> ${a}`);let n=this.sectionValue(6);return t.cell=`${t.name}(${n.name})`,t}}]},{id:"mk-flow-subroutine",type:"action",shape:"slot",category:"presentation",draggable:!0,state:{data:{sections:[{type:"text",text:"SUB"},{type:"argument",datatype:"number"},{type:"text",text:"TAG"},{type:"argument",datatype:"string",data:{value:"子程序"}},{type:"text",text:"URL"},{type:"argument",datatype:"string"},{type:"argument",datatype:"enum",data:{currentIndex:3,values:[{name:"left",value:0},{name:"top",value:1},{name:"right",value:2},{name:"bottom",value:3}]}}]}},export:[{fmt:"markdown",ext:".md",action:function(){let t={type:"sub",index:0,name:"",def:"",cell:""};t.name=t.type+Ct(),t.index=this.sectionValue(1);let e=this.sectionValue(3);t.def=`${t.name}=>subroutine: ${e}`;let a=this.sectionValue(5);a.length>0&&(t.def+=`:> ${a}`);let n=this.sectionValue(6);return t.cell=`${t.name}(${n.name})`,t}}]},{id:"mk-flow-inputoutput",type:"action",shape:"slot",category:"presentation",draggable:!0,state:{data:{sections:[{type:"text",text:"I/O"},{type:"argument",datatype:"number"},{type:"text",text:"TAG"},{type:"argument",datatype:"string",data:{value:"输出"}},{type:"text",text:"URL"},{type:"argument",datatype:"string"},{type:"argument",datatype:"enum",data:{currentIndex:3,values:[{name:"left",value:0},{name:"top",value:1},{name:"right",value:2},{name:"bottom",value:3}]}}]}},export:[{fmt:"markdown",ext:".md",action:function(){let t={type:"io",index:0,name:"",def:"",cell:""};t.name=t.type+Ct(),t.index=this.sectionValue(1);let e=this.sectionValue(3);t.def=`${t.name}=>inputoutput: ${e}`;let a=this.sectionValue(5);a.length>0&&(t.def+=`:> ${a}`);let n=this.sectionValue(6);return t.cell=`${t.name}(${n.name})`,t}}]},{id:"mk-flow-condition",type:"control",shape:"cuptwo",category:"presentation",draggable:!0,state:{data:{other:{type:"text",text:"No"},sections:[{type:"text",text:"COND"},{type:"argument",datatype:"number"},{type:"text",text:"TAG"},{type:"argument",datatype:"string",data:{value:"条件"}},{type:"text",text:"Yes"},{type:"argument",datatype:"enum",data:{currentIndex:2,values:[{name:"left",value:0},{name:"top",value:1},{name:"right",value:2},{name:"bottom",value:3}]}}]}},export:[{fmt:"markdown",ext:".md",action:function(){let t={type:"c",index:0,name:"",def:"",yes:"",no:""};t.name=t.type+Ct(),t.index=this.sectionValue(1);let e=this.sectionValue(3);t.def=`${t.name}=>condition: ${e}`;let a=this.sectionValue(5);return t.yes=`${t.name}(yes, ${a.name})`,t.no=`${t.name}(no)`,t}}]}];let St=[];St=St.concat($t);var Ht=St,Nt={categories:L,packages:[ft,kt,Bt,Ht]};const At="http://www.w3.org/2000/svg";function jt(t,e){const a=t.tagName;return`${a} ${e} event: `}const Pt={resize:"ycBlockEventResize",position:"ycBlockEventPosition",positionText:"ycBlockEventPositionText",background:"ycBlockEventBackground",change:"ycBlockEventChange",changeImage:"ycBlockEventChangeImage"},Tt={};Tt[Pt.resize]=function(t,e){t.stopPropagation();const a=jt(this,Pt.resize);e?(b.isNumber(e.width)?this.setAttribute("width",e.width):g.warn(a+"width is not number"),b.isNumber(e.height)?this.setAttribute("height",e.height):g.warn(a+"height is not number")):g.warn(a+"opt is null")},Tt[Pt.position]=function(t,e){t.stopPropagation();const a=jt(this,Pt.position);if(!e)return void g.warn(a+"opt is null");let n=0,i=0;e.translatex&&(b.isNumber(e.translatex)?n=e.translatex:g.warn(a+"translatex is not number")),e.translatey&&(b.isNumber(e.translatey)?i=e.translatey:g.warn(a+"translatey is not number")),this.setAttribute("transform",`translate(${n}, ${i})`)},Tt[Pt.positionText]=function(t,e){t.stopPropagation();const a=jt(this,Pt.positionText);if(!e)return void g.warn(a+"opt is null");e.x&&(b.isNumber(e.x)?this.setAttribute("x",e.x):g.warn(a+"x is not number")),e.y&&(b.isNumber(e.y)?this.setAttribute("y",e.y):g.warn(a+"y is not number"));let n=0,i=0;e.translatex&&(b.isNumber(e.translatex)?n=e.translatex:g.warn(a+"translatex is not number")),e.translatey&&(b.isNumber(e.translatey)?i=e.translatey:g.warn(a+"translatey is not number")),this.setAttribute("transform",`translate(${n}, ${i})`)},Tt[Pt.background]=function(t,e){t.stopPropagation();const a=jt(this,Pt.background);e?(e.stroke&&(b.isString(e.stroke)?this.setAttribute("stroke",e.stroke):g.warn(a+"stroke is not string")),e.fill&&(b.isString(e.fill)?this.setAttribute("fill",e.fill):g.warn(a+"fill is not string")),e.opacity&&(b.isNumber(+e.opacity)?this.setAttribute("fill-opacity",e.opacity):g.warn(a+"opacity is not number"))):g.warn(a+"opt is null")},Tt[Pt.changeImage]=function(t,e){t.stopPropagation();const a=jt(this,Pt.changeImage);e?e.url&&(b.isString(e.url)?this.href.baseVal=e.url:g.warn(a+"url is not string")):g.warn(a+"opt is null")};const Dt=48,It=64,Ot=96,Ft=22,Rt=4,Et=20;function Wt(t,e){return b.isFunction(e)?e(t)?t:null:t}const Mt={events:Pt,path:{cap:function(t){const e=document.createElementNS(At,"path"),a=w()(e);t||(t={});const n=Ot+16,i=40;let s={caveRight:Dt,bulgeWidth:Ot,cornerRadius:Rt,bulgeHeight:Ft,width:n+2*Rt,height:i+2*Rt,contentWidth:n,contentHeight:i};const o=(t,e)=>{let a=Object.assign({},t);if(!e)return a;let s=!1;return b.isNumber(e.contentWidth)&&(s=!0,a.contentWidth=Math.max(e.contentWidth,n)),b.isNumber(e.contentHeight)&&(s=!0,a.contentHeight=Math.max(e.contentHeight,i)),s&&(a.width=a.contentWidth+2*a.cornerRadius,a.height=a.contentHeight+2*a.cornerRadius),a};s=o(s,t);const r="`m 0,0 c 25, ${ -size.bulgeHeight } 71,${ -size.bulgeHeight } ${ size.bulgeWidth },0 H ${ size.width - size.cornerRadius } a 4,4 0 0,1 4,4 v ${size.contentHeight}  a 4,4 0 0,1 -4,4 H ${ size.caveRight }   c -2,0 -3,1 -4,2 l -4,4 c -1,1 -2,2 -4,2 h -12 c -2,0 -3,-1 -4,-2 l -4,-4 c -1,-1 -2,-2 -4,-2 H 4 a 4,4 0 0,1 -4,-4 z`",l=new Function("size","return "+r);return e.setAttribute("d",l(s)),t.stroke&&e.setAttribute("stroke",t.stroke),t.fill&&e.setAttribute("fill",t.fill),t.opacity&&e.setAttribute("fill-opacity",t.opacity),a.addClass("ycBlockPath ycBlockBackground"+(t.classes?" "+t.classes:"")),a.on(Pt.resize,function(t,e){t.stopPropagation();let a=jt(this,Pt.resize);e?(e.contentWidth=Wt(e.contentWidth,b.isNumber),e.contentHeight=Wt(e.contentHeight,b.isNumber),s=o(s,e),this.setAttribute("d",l(s)),this.__boundbox=s):g.warn(a+"opt is null")}),e.__boundbox=s,e},hat:function(t){const e=document.createElementNS(At,"path"),a=w()(e);t||(t={});const n=Ot+16,i=40;let s={caveRight:Dt,bulgeRadius:Et,cornerRadius:Rt,width:n+2*Rt,height:i+2*Rt,contentWidth:n,contentHeight:i};const o=(t,e)=>{let a=Object.assign({},t);if(!e)return a;let s=!1;return b.isNumber(e.contentWidth)&&(s=!0,a.contentWidth=Math.max(e.contentWidth,n)),b.isNumber(e.contentHeight)&&(s=!0,a.contentHeight=Math.max(e.contentHeight,i)),s&&(a.width=a.contentWidth+2*a.cornerRadius,a.height=a.contentHeight+a.cornerRadius),a};s=o(s,t);const r="`m 0, 0 a 20,20 0 0,1 20,-20 H ${ size.width - size.cornerRadius } a 20,20 0 0,1 20,20 v ${ size.contentHeight } a 4,4 0 0,1 -4,4 H ${ size.caveRight } c -2,0 -3,1 -4,2 l -4,4 c -1,1 -2,2 -4,2 h -12 c -2,0 -3,-1 -4,-2 l -4,-4 c -1,-1 -2,-2 -4,-2 H 4 a 4,4 0 0,1 -4,-4 z`",l=new Function("size","return "+r);return e.setAttribute("d",l(s)),t.stroke&&e.setAttribute("stroke",t.stroke),t.fill&&e.setAttribute("fill",t.fill),t.opacity&&e.setAttribute("fill-opacity",t.opacity),a.addClass("ycBlockPath ycBlockBackground"+(t.classes?" "+t.classes:"")),a.on(Pt.resize,function(t,e){t.stopPropagation();let a=jt(this,Pt.resize);e?(e.contentWidth=Wt(e.contentWidth,b.isNumber),e.contentHeight=Wt(e.contentHeight,b.isNumber),s=o(s,e),this.setAttribute("d",l(s)),this.__boundbox=s):g.warn(a+"opt is null")}),e.__boundbox=s,e},cup:function(t){const e=document.createElementNS(At,"path"),a=w()(e);t||(t={});const n=Dt+104,i=40,s=24,o=24;let r={caveRight:Dt,caveSecondRight:It,cornerRadius:Rt,width:n+2*Rt,height:i+2*Rt,contentWidth:n,contentHeight:i,slotHeight:o,bottomHeight:s,wholeHeight:i+o+s+4*Rt};const l=(t,e)=>{let a=Object.assign({},t);if(!e)return a;let s=!1;return b.isNumber(e.contentWidth)&&(s=!0,a.contentWidth=Math.max(e.contentWidth,n)),b.isNumber(e.contentHeight)&&(s=!0,a.contentHeight=Math.max(e.contentHeight,i)),b.isNumber(e.slotHeight)&&(s=!0,a.slotHeight=Math.max(e.slotHeight,o)),s&&(a.width=a.contentWidth+2*a.cornerRadius,a.height=a.contentHeight+2*a.cornerRadius,a.wholeHeight=a.height+a.slotHeight+a.bottomHeight+2*Rt),a};r=l(r,t);const c="`m 0,4 A 4,4 0 0,1 4,0 H 12 c 2,0 3,1 4,2 l 4,4 c 1,1 2,2 4,2 h 12 c 2,0 3,-1 4,-2 l 4,-4 c 1,-1 2,-2 4,-2 H ${ size.width - size.cornerRadius } a 4,4 0 0,1 4,4 v ${ size.contentHeight}  a 4,4 0 0,1 -4,4 H ${ size.caveSecondRight } c -2,0 -3,1 -4,2 l -4,4 c -1,1 -2,2 -4,2 h -12 c -2,0 -3,-1 -4,-2 l -4,-4 c -1,-1 -2,-2 -4,-2 h -8  a 4,4 0 0,0 -4,4 v ${ size.slotHeight - size.cornerRadius * 2 } a 4,4 0 0,0 4,4 h  8 c 2,0 3,1 4,2 l 4,4 c 1,1 2,2 4,2 h 12 c 2,0 3,-1 4,-2 l 4,-4 c 1,-1 2,-2 4,-2 H ${ size.width - size.cornerRadius } a 4,4 0 0,1 4,4 v ${ size.bottomHeight }  a 4,4 0 0,1 -4,4 ",d=[" H ${ size.caveRight } c -2,0 -3,1 -4,2 l -4,4 c -1,1 -2,2 -4,2 h -12 c -2,0 -3,-1 -4,-2 l -4,-4 c -1,-1 -2,-2 -4,-2 H 4 a 4,4 0 0,1 -4,-4 z`"," H 4 a 4,4 0 0,1 -4,-4 z`"],u=new Function("size","return "+c+(t.end?d[1]:d[0]));e.setAttribute("d",u(r)),t.stroke&&e.setAttribute("stroke",t.stroke),t.fill&&e.setAttribute("fill",t.fill),t.opacity&&e.setAttribute("fill-opacity",t.opacity),a.addClass("ycBlockPath ycBlockBackground"+(t.classes?" "+t.classes:""));const h=[Pt.background];for(let p of h.values())a.on(p,Tt[p]);return a.on(Pt.resize,function(t,e){t.stopPropagation();let a=jt(this,Pt.resize);e?(e.contentWidth=Wt(e.contentWidth,b.isNumber),e.contentHeight=Wt(e.contentHeight,b.isNumber),e.slotHeight=Wt(e.slotHeight,b.isNumber),r=l(r,e),this.setAttribute("d",u(r)),this.__boundbox=r):g.warn(a+"opt is null")}),e.__boundbox=r,e},cuptwo:function(t){const e=document.createElementNS(At,"path"),a=w()(e);t||(t={});const n=Dt+104,i=40,s=24,o=24,r=24;let l={caveRight:Dt,caveSecondRight:It,cornerRadius:Rt,width:n+2*Rt,height:i+2*Rt,contentWidth:n,contentHeight:i,slotHeight:[o,o],centerHeight:r,bottomHeight:s,wholeHeight:i+2*o+r+s+6*Rt};const c=(t,e)=>{let a=Object.assign({},t);if(!e)return a;let s=!1;return b.isNumber(e.contentWidth)&&(s=!0,a.contentWidth=Math.max(e.contentWidth,n)),b.isNumber(e.contentHeight)&&(s=!0,a.contentHeight=Math.max(e.contentHeight,i)),e.slotHeight&&b.isArray(e.slotHeight)&&(s=!0,a.slotHeight[0]=Math.max(e.slotHeight[0],o),a.slotHeight[1]=Math.max(e.slotHeight[1],o)),s&&(a.width=a.contentWidth+2*a.cornerRadius,a.height=a.contentHeight+2*a.cornerRadius,a.wholeHeight=a.height+a.slotHeight[0]+a.centerHeight+a.slotHeight[1]+a.bottomHeight+4*Rt),a};l=c(l,t);const d="`m 0,4 A 4,4 0 0,1 4,0 H 12 c 2,0 3,1 4,2 l 4,4 c 1,1 2,2 4,2 h 12 c 2,0 3,-1 4,-2 l 4,-4 c 1,-1 2,-2 4,-2 H ${ size.width - size.cornerRadius } a 4,4 0 0,1 4,4 v ${size.contentHeight}  a 4,4 0 0,1 -4,4 H ${size.caveSecondRight} c -2,0 -3,1 -4,2 l -4,4 c -1,1 -2,2 -4,2 h -12 c -2,0 -3,-1 -4,-2 l -4,-4 c -1,-1 -2,-2 -4,-2 h -8  a 4,4 0 0,0 -4,4 v ${size.slotHeight[0] - size.cornerRadius * 2} a 4,4 0 0,0 4,4 h  8 c 2,0 3,1 4,2 l 4,4 c 1,1 2,2 4,2 h 12 c 2,0 3,-1 4,-2 l 4,-4 c 1,-1 2,-2 4,-2 H ${size.width - size.cornerRadius} a 4,4 0 0,1 4,4 v ${size.centerHeight}  a 4,4 0 0,1 -4,4 H ${size.caveSecondRight} c -2,0 -3,1 -4,2 l -4,4 c -1,1 -2,2 -4,2 h -12 c -2,0 -3,-1 -4,-2 l -4,-4 c -1,-1 -2,-2 -4,-2 h -8  a 4,4 0 0,0 -4,4 v ${size.slotHeight[1] - size.cornerRadius * 2} a 4,4 0 0,0 4,4 h  8 c 2,0 3,1 4,2 l 4,4 c 1,1 2,2 4,2 h 12 c 2,0 3,-1 4,-2 l 4,-4 c 1,-1 2,-2 4,-2 H ${ size.width - size.cornerRadius } a 4,4 0 0,1 4,4 v ${ size.bottomHeight }  a 4,4 0 0,1 -4,4 ",u=[" H ${ size.caveRight } c -2,0 -3,1 -4,2 l -4,4 c -1,1 -2,2 -4,2 h -12 c -2,0 -3,-1 -4,-2 l -4,-4 c -1,-1 -2,-2 -4,-2 H 4 a 4,4 0 0,1 -4,-4 z`"," H 4 a 4,4 0 0,1 -4,-4 z`"],h=new Function("size","return "+d+(t.end?u[1]:u[0]));e.setAttribute("d",h(l)),t.stroke&&e.setAttribute("stroke",t.stroke),t.fill&&e.setAttribute("fill",t.fill),t.opacity&&e.setAttribute("fill-opacity",t.opacity),a.addClass("ycBlockPath ycBlockBackground"+(t.classes?" "+t.classes:""));const p=[Pt.background];for(let m of p.values())a.on(m,Tt[m]);return a.on(Pt.resize,function(t,e){t.stopPropagation();let a=jt(this,Pt.resize);e?(e.contentWidth=Wt(e.contentWidth,b.isNumber),e.contentHeight=Wt(e.contentHeight,b.isNumber),b.isArray(e.slotHeight)?(e.slotHeight[0]=Wt(e.slotHeight[0],b.isNumber),e.slotHeight[1]=Wt(e.slotHeight[1],b.isNumber)):e.slotHeight=null,l=c(l,e),this.setAttribute("d",h(l)),this.__boundbox=l):g.warn(a+"opt is null")}),e.__boundbox=l,e},slot:function(t){const e=document.createElementNS(At,"path"),a=w()(e);t||(t={});const n=84,i=40;let s={caveRight:Dt,cornerRadius:Rt,width:n+2*Rt,height:i+2*Rt,contentWidth:n,contentHeight:i};const o=(t,e)=>{let a=Object.assign({},t);if(!e)return a;let s=!1;return b.isNumber(e.contentWidth)&&(s=!0,a.contentWidth=Math.max(e.contentWidth,n)),b.isNumber(e.contentHeight)&&(s=!0,a.contentHeight=Math.max(e.contentHeight,i)),s&&(a.width=a.contentWidth+2*a.cornerRadius,a.height=a.contentHeight+2*a.cornerRadius),a};s=o(s,t);const r="`m 0,4 A 4,4 0 0,1 4,0 H 12 c 2,0 3,1 4,2 l 4,4 c 1,1 2,2 4,2 h 12 c 2,0 3,-1 4,-2 l 4,-4 c 1,-1 2,-2 4,-2 H ${ size.width - size.cornerRadius } a 4,4 0 0,1 4,4 v ${ size.contentHeight } a 4,4 0 0,1 -4,4 ",l=[" H ${ size.caveRight } c -2,0 -3,1 -4,2 l -4,4 c -1,1 -2,2 -4,2 h -12 c -2,0 -3,-1 -4,-2 l -4,-4 c -1,-1 -2,-2 -4,-2 H 4 a 4,4 0 0,1 -4,-4 z`"," H 4 a 4,4 0 0,1 -4,-4 z`"],c=new Function("size","return "+r+(t.end?l[1]:l[0]));e.setAttribute("d",c(s)),t.stroke&&e.setAttribute("stroke",t.stroke),t.fill&&e.setAttribute("fill",t.fill),t.opacity&&e.setAttribute("fill-opacity",t.opacity),a.addClass("ycBlockPath ycBlockBackground"+(t.classes?" "+t.classes:""));const d=[Pt.background];for(let u of d.values())a.on(u,Tt[u]);return a.on(Pt.resize,function(t,e){t.stopPropagation();let a=jt(this,Pt.resize);e?(e.contentWidth=Wt(e.contentWidth,b.isNumber),e.contentHeight=Wt(e.contentHeight,b.isNumber),s=o(s,e),this.setAttribute("d",c(s)),this.__boundbox=s):g.warn(a+"opt is null")}),e.__boundbox=s,e},roundRect:function(t){let e=document.createElementNS(At,"path"),a=w()(e);t||(t={});const n=40,i=16;let s={width:n,height:2*i,radius:i,contentWidth:n-2*i,contentHeight:2*i};const o=(t,e)=>{let a=Object.assign({},t);if(!e)return a;let s=!1;return b.isNumber(e.height)&&(s=!0,a.radius=Math.max(e.height/2,i)),b.isNumber(e.width)&&(s=!0,a.width=Math.max(e.width,n)),s&&(a.height=2*a.radius,a.contentWidth=a.width-a.height),a};s=o(s,t);const r="`m 0,0 m ${size.radius},0 H ${size.radius + size.contentWidth} a ${size.radius} ${size.radius} 0 0 1 0 ${size.radius * 2} H ${size.radius} a ${size.radius} ${size.radius} 0 0 1 0 ${size.radius * -2} z`",l=new Function("size","return "+r);e.setAttribute("d",l(s)),t.stroke&&e.setAttribute("stroke",t.stroke),t.fill&&e.setAttribute("fill",t.fill),t.opacity&&e.setAttribute("fill-opacity",t.opacity),a.addClass("ycBlockPath ycBlockBackground"+(t.classes?" "+t.classes:""));const c=[Pt.background];for(let d of c.values())a.on(d,Tt[d]);return a.on(Pt.resize,function(t,e){t.stopPropagation();const a=jt(this,Pt.resize);e?(e.width=Wt(e.width,b.isNumber),e.height=Wt(e.height,b.isNumber),s=o(s,e),this.setAttribute("d",l(s)),this.__boundbox=s):g.warn(a+"opt is null")}),e.__boundbox=s,e},diamondRect:function(t){let e=document.createElementNS(At,"path"),a=w()(e);const n=40,i=16;t||(t={});let s={width:n,height:2*i,side:i,contentWidth:n-2*i,contentHeight:2*i};const o=(t,e)=>{let a=Object.assign({},t);if(!e)return a;let s=!1;return b.isNumber(e.height)&&(s=!0,a.side=Math.max(e.height/2,i)),b.isNumber(e.width)&&(a.width=Math.max(e.width,n)),s&&(a.height=2*a.side,a.contentWidth=a.width-a.height),a};s=o(s,t);const r="`m 0,0 m ${size.side},0 H ${size.side + size.contentWidth} l ${size.side} ${size.side} l ${-size.side} ${size.side} H ${size.side} l ${-size.side} ${-size.side} l ${size.side} ${-size.side} z`",l=new Function("size","return "+r);e.setAttribute("d",l(s)),t.stroke&&e.setAttribute("stroke",t.stroke),t.fill&&e.setAttribute("fill",t.fill),t.opacity&&e.setAttribute("fill-opacity",t.opacity),a.addClass("ycBlockPath ycBlockBackground"+(t.classes?" "+t.classes:""));const c=[Pt.background];for(let d of c.values())a.on(d,Tt[d]);return a.on(Pt.resize,function(t,e){t.stopPropagation();const a=jt(this,Pt.resize);e?(e.width=Wt(e.width,b.isNumber),e.height=Wt(e.height,b.isNumber),s=o(s,e),this.setAttribute("d",l(s)),this.__boundbox=s):g.warn(a+"opt is null")}),e.__boundbox=s,e},marker:function(t){let e=document.createElementNS(At,"path"),a=w()(e);return e.setAttribute("stroke",t.stroke),e.setAttribute("fill",t.fill),e.setAttribute("fill-opacity",t.opacity),a.addClass("ycBlockPath ycBlockBackground"+(t.classes?" "+t.classes:"")),e}},group:{flyoutLabel:function(t){let e=document.createElementNS(At,"g"),a=w()(e);e.setAttribute("display","block"),e.setAttribute("transform",`translate(${t.translatex?t.translatex:0}, ${t.translatey?t.translatey:0})`),a.addClass("ycBlockFlyoutLabel"+(t.classes?" "+t.classes:""));let n=document.createElementNS(At,"rect");n.setAttribute("rx","4"),n.setAttribute("ry","4"),n.setAttribute("width",t.width),n.setAttribute("height",t.height),n.classList.add("ycBlockFlyoutLabelBackground"),e.appendChild(n);let i=document.createElementNS(At,"text");return i.setAttribute("x","0"),i.setAttribute("y",t.height/2),i.setAttribute("dy","0"),i.setAttribute("text-anchor","start"),i.setAttribute("dominant-baseline","central"),i.classList.add("ycBlockFlyoutLabelText"),i.textContent=t.text?t.text:"",e.appendChild(i),e},editableText:function(t){let e=document.createElementNS(At,"g"),a=w()(e);e.setAttribute("transform",`translate(${t.translatex?t.translatex:4}, ${t.translatey?t.translatey:0})`),e.classList.add("ycBlockEditableText");let n=Mt.base.text(t);return e.appendChild(n),a.on(Pt.positionText,function(t,e){t.stopPropagation();const a=w()(this),n=jt(this,Pt.positionText);if(!e)return void g.warn(n+"opt is null");let i=0,s=0;e.translatex&&(b.isNumber(e.translatex)?i=e.translatex:g.warn(n+"translatex is not number")),e.translatey&&(e.translatey&&!b.isNumber(e.translatey)?g.warn(n+"translatey is not number"):s=e.translatey),this.setAttribute("transform",`translate(${i}, ${s})`);let o=a.children("text");o.trigger(Pt.positionText,[{x:e.x,y:e.y}])}).on(Pt.change,function(t,e){t.stopPropagation();const a=w()(this);let n=a.children("text");n.trigger(Pt.change,[e])}),e},image:function(t){let e=document.createElementNS(At,"g"),a=w()(e);e.setAttribute("transform",`translate(${t.translatex?t.translatex:0}, ${t.translatey?t.translatey:0})`);let n=Mt.base.image(t);e.appendChild(n);const i=[Pt.position];for(let s of i.values())a.on(s,Tt[s]);return a.on(Pt.changeImage,function(t,e){t.stopPropagation();let a=w()(this),n=a.children("image");n.trigger(Pt.changeImage,e)}),e}},base:{text:function(t){let e=document.createElementNS(At,"text"),a=w()(e);t||(t={}),a.addClass("ycBlockText"+(t.classes?" "+t.classes:"")),e.setAttribute("text-anchor",t.anchor?t.anchor:"middle"),e.setAttribute("dominant-baseline",t.baseline?t.baseline:"central"),e.setAttribute("dy","0"),e.setAttribute("x",t.x?t.x:0),e.setAttribute("y",t.y?t.y:0),e.setAttribute("transform",`translate(${t.translatex?t.translatex:0}, ${t.translatey?t.translatey:0})`),e.textContent=t.text?t.text:"";const n=[Pt.positionText];for(let i of n.values())a.on(i,Tt[i]);return a.on(Pt.change,function(t,e){t.stopPropagation();const a=w()(this),n=jt(this,Pt.change);b.isString(e)?a.html(""+e):g.warn(n+"value is not string")}),e},group:function(t){let e=document.createElementNS(At,"g"),a=w()(e);const n=[Pt.position];for(let i of n.values())a.on(i,Tt[i]);return e},arguGroup:function(t){let e=document.createElementNS(At,"g"),a=w()(e);t.type&&e.setAttribute("data-argument-type",t.id),t.shape&&e.setAttribute("data-shape",t.shape),e.setAttribute("transform",`translate(${t.translatex?t.translatex:0}, ${t.translatey?t.translatey:0})`);const n=[Pt.position];for(let i of n.values())a.on(i,Tt[i]);return a.on(Pt.background,function(t,e){t.stopPropagation();const a=w()(this),n=a.children("path"),i=`arguGroup ${Pt.background} event: `;e?(e.stroke&&(b.isString(e.stroke)?n.attr("stroke",e.stroke):g.warn(i+"stroke is not string")),e.fill&&(b.isString(e.fill)?n.attr("fill",e.stroke):g.warn(i+"fill is not string")),e.opacity&&(b.isNumber(+e.opacity)?n.attr("fill-opacity",e.opacity):g.warn(i+"opacity is not number"))):g.warn(i+"opt is null")}),e},rect:function(t){let e=document.createElementNS(At,"rect"),a=w()(e),n=t.radius?t.radius:4;e.setAttribute("rx",n),e.setAttribute("ry",n),e.setAttribute("width",t.width?t.width:0),e.setAttribute("height",t.height?t.height:0),t.stroke&&e.setAttribute("stroke",t.stroke),t.fill&&e.setAttribute("fill",t.fill),t.opacity&&e.setAttribute("fill-opacity",t.opacity),e.classList.add("ycBlockBackground");const i=[Pt.resize,Pt.background];for(let s of i.values())a.on(s,Tt[s]);return e},image:function(t){let e=document.createElementNS(At,"image"),a=w()(e);e.setAttribute("height",t.width?t.width:0),e.setAttribute("width",t.height?t.height:0),e.setAttribute("transform","translate(0,0)"),e.href.baseVal=t.url,b.isNumber(t.x)&&e.setAttribute("x",t.x),b.isNumber(t.y)&&e.setAttribute("y",t.y);const n=[Pt.resize,Pt.position,Pt.changeImage];for(let i of n.values())a.on(i,Tt[i]);return e}}};var Vt=Mt,Lt=a("45cf");const Gt=12,qt=16,Ut={computeTextLength:function(t){if(!b.isString(t)||""===t)return 0;let e=t.length*Gt,a=b.strByteLength(t)-t.length;return e+=a*(qt-Gt),e},isIntersects:function(t,e,a=0,n=0){let i=Ut.normalizeBoundbox(t),s=Ut.normalizeBoundbox(e),o=b.isNumber(a)?Math.max(a,0):0,r=b.isNumber(n)?Math.max(n,0):0;return!(i.left>s.right+r||i.right<s.left-r||i.top>s.bottom+o||i.bottom<s.top-o)},isContains:function(t,e,a=0,n=0){let i=Ut.normalizeBoundbox(t),s=b.isNumber(a)?Math.max(a,0):0,o=b.isNumber(n)?Math.max(n,0):0;return!(e.x>i.right+o||e.x<i.left-o||e.y>i.bottom+s||e.y<i.top-s)},normalizeBoundbox(t){let e=Object.assign({},t);return t.left>t.right&&(e.left=t.right,e.right=t.left),t.top>t.bottom&&(e.top=t.bottom,e.bottom=t.top),e},boundRect(t,e,a,n,i,s){let o=b.isNumber(i)?i:1,r=b.isNumber(s)?s:1;return{left:t/o,top:e/r,right:t/o+a,bottom:e/r+n}},translateRect(t,e,a){return{left:t.left+e,top:t.top+a,right:t.right+e,bottom:t.bottom+a}},domClearChildren(t){while(t.firstChild)t.removeChild(t.firstChild)},domChildrenByTagName(t,e){var a=[],n=t.getElementsByTagName(e);for(let s of n)if(1===s.nodeType){var i=n.parentNode;1===i.nodeType?i===t&&a.push(s):i.parentNode===s&&a.push(s)}return a},domChildren(t){return Lt["utils"].domQuerySelectByTagName(t,"*")}};var Yt=Ut,Xt=a("c64e"),Zt=a.n(Xt);const Jt={number:{name:"数值",shape:"round",data:{background:{stroke:"#333333",fill:"#FFFFFF",opacity:"1"}}},string:{name:"字符串",shape:"round",data:{background:{stroke:"#333333",fill:"#FFFFFF",opacity:"1"}}},boolean:{name:"布尔值",shape:"diamond",data:{background:{chameleon:!0,stroke:"#333333",fill:"#FFFFFF",opacity:"1"}}},enum:{name:"枚举值",shape:"round",data:{background:{chameleon:!0,stroke:"#333333",fill:"#FFFFFF",opacity:"1"},space:4,button:{url:"/img/dropdown-arrow.svg",width:12,height:12}}}};class Qt{constructor(t){this.section=t}textWidth(t){const e=this.section.dom.__panel.dom.canvas;let a=Vt.base.text({text:t});a.style.visibility="hidden",e.appendChild(a);let n=a.getComputedTextLength();return a.remove(),n}data(t){return t?this.section.dom.getAttribute("data-"+t):null}static argument(t){return"argument"!==t.type?(g.warn("Argument wrapper failed: invalid param --",t),null):"string"===t.datatype?new Kt(t):"number"===t.datatype?new te(t):"boolean"===t.datatype?new ee(t):"enum"===t.datatype?new ae(t):(g.warn("Argument wrapper failed: invalid datatype --",t),null)}static createContainer(t){const e=Vt.base.group(),a=w()(e),n=["shape","argument-type"];for(let o of n){let a=t[o];b.isString(a)?e.setAttribute("data-"+o,a):g.warn(`Argument createContainer failed: ${o} is not string --`,a)}let i=w.a.extend(!0,{},t.data.size,t.data.background),s=null;return s="round"===t.shape?Vt.path.roundRect(i):"diamond"===t.shape?Vt.path.diamondRect(i):Vt.path.roundRect(i),e.appendChild(s),a.on(Vt.events.background,function(t,e){t.stopPropagation();let a=w()(this).children("path");a.trigger(Vt.events.background,[e])}),e}static createElement(t){if(!b.isObject(t))return void g.warn("Argument createElement failed: param is invalid --",t);const e=Jt[t.datatype];if(!e)return void g.warn("Argument createElement failed: id is invalid --",t);t.name=e.name,t.shape=e.shape,t["argument-type"]=t.datatype,b.isObject(e.data)&&(t.data=w.a.extend(!0,{size:{minWidth:40,minHeight:32,width:40,height:32}},e.data,t.data)),b.isNull(t.data)&&(t.data={});let a=null;return"string"===t.datatype?a=Kt.createElement(t):"number"===t.datatype?a=te.createElement(t):"boolean"===t.datatype?a=ee.createElement(t):"enum"===t.datatype?a=ae.createElement(t):g.warn(`addArgument failed: unkown argument type -- ${t.datatype}`),a}translate(t,e){w()(this.section.dom).trigger(Vt.events.position,[{translatex:t,translatey:e}])}boundRect(t,e){const a=w()(this.section.dom).children("path.ycBlockBackground"),n=a[0].getBBox(),i=this.section.dom.getCTM();return Yt.boundRect(Number(i.e)+t,Number(i.f)+e,n.width,n.height,Number(i.a),Number(i.d))}highlight(t=!0){const e=w()(this.section.dom).children("path.ycBlockBackground");e.attr("filter",t?"url(#ycBlockReplacementGlowFilter)":"")}show(){this.section.dom.setAttribute("visibility","visible")}hide(){this.section.dom.setAttribute("visibility","hidden")}adjust(){}}class Kt extends Qt{constructor(t){super(t)}static createElement(t){let e=Qt.createContainer(t),a=w()(e);b.isString(t.data.value)||(t.data.value="");let n=Vt.group.editableText({text:t.data.value});return a.append(n),e}adjust(){const t=w()(this.section.dom),e=this.section.data;let a=t.children(".ycBlockEditableText");a.trigger(Vt.events.change,[""+e.value]);let n=e.size.height/2,i=this.textWidth(""+e.value);e.size.width=Math.max(i+2*n,e.size.minWidth);let s=t.children("path");s.trigger(Vt.events.resize,[{width:e.size.width,height:e.size.height}]),e.size.width=s[0].__boundbox.width,e.size.height=s[0].__boundbox.height,a.trigger(Vt.events.positionText,[{x:e.size.width/2,y:0,translatex:0,translatey:e.size.height/2}])}}class te extends Qt{constructor(t){super(t)}static createElement(t){const e=Qt.createContainer(t),a=w()(e);b.isNumber(t.data.value)||(t.data.value=0);let n=Vt.group.editableText({text:""+t.data.value});return a.append(n),e}adjust(){const t=w()(this.section.dom),e=this.section.data;let a=t.children(".ycBlockEditableText");a.trigger(Vt.events.change,[""+e.value]);let n=e.size.height/2,i=this.textWidth(""+e.value);e.size.width=Math.max(i+2*n,e.size.minWidth);let s=t.children("path");s.trigger(Vt.events.resize,[{width:e.size.width,height:e.size.height}]),e.size.width=s[0].__boundbox.width,e.size.height=s[0].__boundbox.height,a.trigger(Vt.events.positionText,[{x:e.size.width/2,y:0,translatex:0,translatey:e.size.height/2}])}}class ee extends Qt{constructor(t){super(t)}static createElement(t){t.data=w.a.extend(!0,t.data,{size:{minWidth:48,width:48}});let e=Qt.createContainer(t);return b.isBoolean(t.data.value)||(t.data.value=!1),e}adjust(){const t=w()(this.section.dom),e=this.section.data;let a=t.children("path");a.trigger(Vt.events.resize,[{width:e.size.width,height:e.size.height}]),e.size.width=a[0].__boundbox.width,e.size.height=a[0].__boundbox.height}}class ae extends Qt{constructor(t){super(t)}static createElement(t){let e=Qt.createContainer(t),a=w()(e);b.isArray(t.data.values)||(t.data.values=[{name:"空",value:-1}]),(!b.isNumber(t.data.currentIndex)||t.data.currentIndex>=t.data.values.length)&&(t.data.currentIndex=0);let n=t.data.values[t.data.currentIndex];return a.append(Vt.base.text({text:n})),a.append(Vt.base.image(t.data.button)),e}adjust(){const t=w()(this.section.dom),e=this.section.data;let a=t.children("text"),n=e.values[e.currentIndex].name;a.trigger(Vt.events.change,[n]);let i=0,s=e.size.height/2;for(let l of e.values)i=Math.max(this.textWidth(""+l.name),i);i+=e.button.width,i+=e.space,e.size.width=Math.max(i+2*s,e.size.minWidth);let o=t.children("path");o.trigger(Vt.events.resize,[{width:e.size.width,height:e.size.height}]),e.size.width=o[0].__boundbox.width,e.size.height=o[0].__boundbox.height,s=e.size.height/2,i=this.textWidth(""+n),a.trigger(Vt.events.positionText,[{x:i/2,y:0,translatex:s,translatey:s}]);let r=t.children("image");r.trigger(Vt.events.position,[{translatex:e.size.width-s-e.button.width/2,translatey:(e.size.height-e.button.height)/2}])}}var ne=Qt;const ie=20;class se{constructor(t,e){this.uid=Zt()(),this.__proto=t,this.dom=null,this.regions={},this.state=w.a.extend(!0,{},this.__proto.def.state),this.update(e,{force:!0})}exportItems(){return this.__proto.def.export?this.__proto.def.export:[]}sectionValue(t){const e=this.stateData();if(!b.isArray(e.sections))return g.warn("BlockInstance sectionValue failed: no section data"),null;if(e.sections.length<=t)return g.warn("BlockInstance sectionValue failed: index out of bound - ",e.sections.length),null;const a=e.sections[t];return"text"===a.type?a.text:"argument"===a.type?"enum"===a.datatype?(g.debug("sectionValue",t,a),a.data.values[a.data.currentIndex]):a.data.value:null}export(t){let e=null;for(let a of this.exportItems())a.fmt===t&&(e=a.action.call(this));return e}protoId(){return this.__proto?this.__proto.def.id:"unknown"}panel(){return this.__proto?this.__proto.def.__panel:null}layoutWidth(){return this.state.size.width}layoutHeight(){return"cup"===this.__proto.def.shape||"cuptwo"===this.__proto.def.shape?this.state.size.wholeHeight:this.state.size.height}sequenceHeight(){let t=this.layoutHeight();const e=this.nextBlock();return e&&(t+=e.sequenceHeight()),t}childType(t){let e=this.element();if(null==t)return e.getAttribute("data-child");const a=["","argument","resolve","reject"];a.indexOf(t)<0?g.warn("BlockInstance childType failed: invalid type --",t):e.setAttribute("data-child",t)}dump(){const t=w()(this.element()),e=t.children("path.ycBlockBackground"),a=e[0].getBBox(),n=this.nextBlock(),i=this.prevBlock(),s=this.rejectBlock(),o=this.rejectBlock(),r={uid:this.uid,protoId:this.protoId(),CTM:this.element().getCTM(),boundbox:a,transform:t.attr("transform"),regions:this.getRegions(),state:{size:this.state.size},stackPosition:this.__proto.stackPosition(),canstackPosition:this.__proto.canStackPosition(),childType:this.childType(),layoutHeight:this.layoutHeight(),sequenceHeight:this.sequenceHeight(),child:{next:n?n.protoId():null,prev:i?i.protoId():null,resolve:s?s.protoId():null,reject:o?o.protoId():null},encode:this.encode()};g.debug("****** Instance Dump ******",r)}protoType(){return this.__proto?this.__proto.def.type:"unknown"}protoShape(){return this.__proto?this.__proto.def.shape:"unknown"}element(){if(!this.dom){let t=w()(this.__proto.prototypeElement).clone(!0);this.dom=t[0],this.dom.__inst=this}return this.dom}hasInclude(t){if(!t)return!1;if(this.uid===t.uid)return!0;let e=!1;return w()(this.element()).find("g.ycBlockDraggable").each(function(){if(this.getAttribute("data-uid")===t.uid)return e=!0,!1}),e}setTranslate(t,e){b.isNumber(t)&&b.isNumber(e)?(this.state.transform.x=t,this.state.transform.y=e,this.element().setAttribute("transform",`translate(${t},${e})`)):g.warn("BlockInstance setTranslate failed: x or y is not a number")}getRegions(){return this.updateDropRegions(),this.regions}canvasPosition(){const t=this.element().getCTM(),e=this.panel().viewPortOffset();return{x:(Number(t.e)-e.x)/Number(t.a),y:(Number(t.f)-e.y)/Number(t.d)}}updateRegion_top(t){if("cap"===this.protoShape()||"hat"===this.protoShape())return void g.warn("Instance _updateregion_top failed: cap or hat can not stack in top");const e=w()(this.element()).children("path.ycBlockBackground"),a=e[0].getBBox(),n=this.canvasPosition();t.stacks.top=Yt.boundRect(n.x,n.y-ie,a.width,ie)}updateRegion_bottom(t){const e=this.protoShape(),a=w()(this.element()).children("path.ycBlockBackground"),n=a[0].getBBox(),i=this.state.size,s=this.canvasPosition();"slot"===e?t.stacks.bottom=Yt.boundRect(s.x,s.y,n.width,n.height+ie):"cap"===e||"hat"===e?t.stacks.bottom=Yt.boundRect(s.x,s.y+n.y,n.width,i.height+ie):"cup"!==e&&"cuptwo"!==e||(t.stacks.bottom=Yt.boundRect(s.x,s.y+n.height-i.bottomHeight,n.width,i.bottomHeight+ie))}updateRegion_resolve(t){const e=this.protoShape(),a=w()(this.element()).children("path.ycBlockBackground"),n=a[0].getBBox(),i=this.state.size,s=this.canvasPosition();let o=["cup","cuptwo"];o.indexOf(e)<0?g.warn("Instance _updateregion_resolve failed: invalid shape -- ",e):t.stacks.resolve=Yt.boundRect(s.x,s.y,n.width,i.height)}updateRegion_reject(t){const e=this.protoShape(),a=w()(this.element()).children("path.ycBlockBackground"),n=a[0].getBBox(),i=this.state.size,s=this.canvasPosition();let o=["cup","cuptwo"];o.indexOf(e)<0?g.warn("Instance _updateregion_reject failed: invalid shape -- ",e):"cuptwo"===e&&(t.stacks.reject=Yt.boundRect(s.x,s.y+i.height+i.resolveHeight,n.width,i.centerHeight+2*i.cornerRadius))}stackPosition(t=!1){let e=this.__proto.stackPosition();if(t){const t=this.lastBlock();if(t!==this){const a=t.__proto.stackPosition();a.indexOf("top")<0&&e.splice(e.findIndex(t=>"top"===t),1)}}return e}updateDropRegions(){if(this.regions={},this.__proto.canStack()){this.regions.stacks={};const t=this.__proto.canStackPosition();for(let e of t)this[`updateRegion_${e}`](this.regions)}this.__proto.canEmbed()&&(this.regions.arguments={},this.state.data.sections.forEach((t,e)=>{if("argument"===t.type)if(t.__assign);else{const a=ne.argument(t);if(a){const n=this.panel().viewPortOffset();this.regions.arguments[e]={shape:a.data("shape"),datatype:t.datatype,rect:a.boundRect(-n.x,-n.y)}}}}))}nextBlock(){const t=w()(this.element()),e=this.panel(),a=e.instances;let n=null;return t.children('g.ycBlockDraggable[data-child=""]').each(function(){if("insertmarker"===this.getAttribute("data-id"))return n=e.marker,!1;let t=this.getAttribute("data-uid");return n=a[t],!1}),n}prevBlock(){const t=this.panel().instances,e=w()(this.element()).parent("g.ycBlockDraggable");if(e.length>0){let a=e.attr("data-uid");return t[a]}return null}lastBlock(){let t=this,e=this.nextBlock();while(e)t=e,e=e.nextBlock();return t}firstBlock(){let t=this,e=this.prevBlock();while(e)t=e,e=e.prevBlock();return t}pop(){let t=this.prevBlock(),e=null;const a=w()(this.element()),n=this.childType();if("argument"===n||(e=this.nextBlock()),t)a.detach(),e&&(e.childType(n),w()(t.element()).append(e.element()));else{if(e){e.childType("");const t=w()(this.panel().dom.canvas),a=this.panel().viewPortOffset();let n=w()(e.element()),i=e.element().getCTM();e.update({transform:{x:(Number(i.e)-a.x)/Number(i.a),y:(Number(i.f)-a.y)/Number(i.d)}}),t.append(n)}a.detach()}}next(t){if(!t)return g.warn("BlockInstance append failed: instance is null"),null;t.childType("");const e=this.nextBlock();w()(t.element()).appendTo(this.element()),e&&t.last(e)}last(t){if(!t)return g.warn("BlockInstance append failed: instance is null"),null;const e=this.nextBlock();e?e.last(t):w()(this.element()).append(t.element())}resolveBlock(){const t=this.panel().instances;let e=null;return w()(this.element()).children('g.ycBlockDraggable[data-child="resolve"]').each(function(){let a=this.getAttribute("data-uid");return e=t[a],!1}),e}rejectBlock(){const t=this.panel().instances;let e=null;return w()(this.element()).children('g.ycBlockDraggable[data-child="reject"]').each(function(){let a=this.getAttribute("data-uid");return e=t[a],!1}),e}resolve(t){if(!t)return g.warn("BlockInstance append failed: instance is null"),null;t.childType("resolve");const e=this.resolveBlock();w()(t.element()).appendTo(this.element()),e&&(e.childType(""),t.last(e))}reject(t){if(!t)return g.warn("BlockInstance append failed: instance is null"),null;t.childType("reject");let e=this.rejectBlock();w()(t.element()).appendTo(this.element()),e&&(e.childType(""),t.last(e))}removeNext(t=!1){const e=this.nextBlock();if(e){if(!t){const t=e.nextBlock();t&&w()(t.element()).insertBefore(e.element())}w()(e.element()).detach()}return e}update(t,e){let a=[],n=null;if(b.isFunction(t)?n=t():b.isObject(t)&&(n=t),e||(e={force:!t,next:!1,prev:!1}),!b.isNull(n)||e.force)if(b.isObject(n)||e.force){if(b.isObject(n))for(let[t,e]of Object.entries(n))b.isObject(e)&&(a.push(t),this.state[t]=w.a.extend(!0,this.state[t],e));if(this.__proto.adjust({dom:this.element(),def:this.__proto.def,state:this.state,modify:e.force?null:a}),!0===e.prev){let t=this.prevBlock();t&&t.update(null,{force:!0,next:!1,prev:!0})}if(!0===e.next){let t=this.nextBlock();t&&t.update(null,{force:!0,next:!0,prev:!1})}}else g.warn(`BlockInstance ${this.uid} update failed: newState is not a Object --`,n);else g.warn(`BlockInstance ${this.uid} update failed: newState is NULL`)}clear(){let t=this.panel();w()(this.element()).children("g.ycBlockDraggable").each(function(){if("insertmarker"===this.getAttribute("data-id"))return!0;let e=this.getAttribute("data-uid");t.removeBlock(e)}),this.__proto.instances.delete(this.uid),w()(this.dom).remove(),this.dom=null}stateData(){return this.state.data||(this.state.data={}),this.state.data}include(t,e){t&&(b.isString(e)&&t.childType(e),w()(this.element()).append(t.element()))}cloneArgument(t){if(!t)return void g.warn("BlockInstance cloneArgument failed: source is null ");if(t.protoId()!==this.protoId())return void g.warn(`BlockInstance cloneArgument failed: source protoId [${t.protoId()}] is not same - `,this.protoId());const e=t.stateData();if(!e.sections)return;const a=this.stateData().sections,n=this;e.sections.forEach(function(t,e){const i=a[e];if("argument"!==t.type)return!0;if("argument"!==i.type)return g.warn(`BlockInstance cloneArgument failed: section [${e}] is not argument - `,i.type),!1;if(t.datatype!==i.datatype)return g.warn(`BlockInstance cloneArgument failed: section [${e}] datatype [${i.datatype}] is not same as - `,t.datatype),!1;if(w.a.extend(!0,a[e].data,t.data),t.__assign){const i=t.__assign.cloneSelf(!0);a[e].__assign=i,n.include(i,"argument")}})}cloneResolve(t){const e=t.resolveBlock();if(!e)return;const a=e.cloneSelf(!0);this.include(a,"resolve")}cloneReject(t){const e=t.rejectBlock();if(!e)return;const a=e.cloneSelf(!0);this.include(a,"reject")}cloneNext(t,e=!1){const a=t.nextBlock();if(!a)return;const n=a.cloneSelf(e);this.include(n,"")}cloneSelf(t=!1){const e=this.panel().addBlock({type:this.protoId()});return e.childType(this.childType()),e.cloneArgument(this),e.cloneResolve(this),e.cloneReject(this),t&&e.cloneNext(this,!0),e.update(),e}cloneStateData(){const t={},e=this.stateData();if(e.sections)return t.sections=[],e.sections.forEach(function(e,a){const n=["dom","__width"];let i={};for(let[t,s]of Object.entries(e))n.indexOf(t)>=0||("data"===t?i.data=w.a.extend(!0,{},e.data):"__assign"===t?s&&(i.__assign=s.encode()):(g.debug("clonedata =====",t,s),i[t]=b.cloneObject(s)));t.sections.push(i)}),t}encode(){const t=this.nextBlock(),e=this.resolveBlock(),a=this.rejectBlock(),n={protoId:this.protoId(),state:{data:this.cloneStateData(),transform:this.state.transform},child:{next:t?t.encode():null,resolve:e?e.encode():null,reject:a?a.encode():null}};return n}decodeStateData(t){if(!t)return;const e=this.panel(),a=this.stateData();t.sections&&(g.debug(a,t),t.sections.forEach((t,n)=>{let i=a.sections[n];if(i.type!==t.type)return g.warn(`BlockInstance decodeStateData failed: section [${n}] type [${i.type}] is not same - `,t.type),!1;if("argument"===t.type&&t.datatype!==i.datatype)return g.warn(`BlockInstance cloneArgument failed: section [${n}] datatype [${i.datatype}] is not same as - `,t.datatype),!1;for(let[a,s]of Object.entries(t))"data"===a?i.data=w.a.extend(!0,{},s):"__assign"===a?s&&(i.__assign=e.createBlock(s),this.include(i.__assign,"argument")):(g.debug("clonedata =====",a,s),i[a]=b.cloneObject(s))}))}decode(t){const e=this.panel();if(this.decodeStateData(t.state.data),t.child.resolve){let a=e.createBlock(t.child.resolve);this.include(a,"resolve")}if(t.child.reject){let a=e.createBlock(t.child.reject);this.include(a,"reject")}if(t.child.next){let a=e.createBlock(t.child.next);this.include(a,"")}this.update()}}class oe extends se{constructor(t,e){super(t,e),this.ghostInstance=null,this.hostInstance=null,this.ghostOffset={x:0,y:0}}layoutHeight(){return this.ghostInstance?this.ghostInstance.layoutHeight():0}empty(){const t=w()(this.element());t.attr("visibility","hidden"),t.children("path").remove(),t.children().detach(),t.detach(),this.ghostInstance=null,this.ghostOffset={x:0,y:0},this.hostInstance=null,this.childType("")}ghost(t,e=!0){if(!t)return void this.empty();let a=w()(this.element());this.ghostInstance=t,this.hostInstance=null;let n=w()(this.ghostInstance.element()),i=n.children("path").clone();i.attr("fill","#000000"),i.attr("stroke","#000000"),i.attr("fill-opacity","0.2"),a.children().remove(),a.append(i),this.dom.setAttribute("visibility",e?"visible":"hidden"),this.ghostOffset.x=0,this.ghostOffset.y=t.layoutHeight()}update(t,e){if(!this.ghostInstance)return;let a=this,n=w()(this.element()),i=this.ghostOffset.y;n.children('g.ycBlockDraggable[data-child=""]').each(function(){let t=this.getAttribute("data-uid"),e=a.__proto.def.__panel.instances[t];e.update({transform:{x:0,y:i}}),i+=e.layoutHeight()})}}const re=40,le=32,ce=4;class de{constructor(t){this.instances=new Map,this.def={child:"",state:{size:{minWidth:re,minContentWidth:re,minHeight:le,minContentHeight:le,space:ce,contentWidth:re,contentHeight:le,width:re,height:le},transform:{x:0,y:0,rotate:0,scale:1},background:{},data:{}}},w.a.extend(!0,this.def,t),this.prototypeElement=this.createPrototype()}canStack(){return!1}isStackBlock(){return!1}canStackPosition(){return[]}stackPosition(){return[]}canEmbed(){return!1}isEmbedBlock(){return!1}isInternal(){return"internal"===this.def.category}textWidth(t){const e=w()(this.def.__panel.dom.canvas);let a=Vt.base.text({text:t});w()(a).css("visibility","hidden"),e.append(a);let n=a.getComputedTextLength();return a.remove(),n}padding(t){let e={left:0,right:0,top:0,bottom:0};if(b.isObject(t)){const a=t.state.size.padding;if(b.isNumber(a))for(let t of Object.keys(e))e[t]=a;else if(b.isObject(a))for(let t of Object.keys(e))a[t]&&(e[t]=a[t])}return e}createPrototype(){const t=this.createElement();return this.adjust({dom:t,def:this.def,state:this.def.state}),t}createElement(){const t=this.createContainer(),e=this.createShape();return e&&w()(t).append(e),t}createContainer(){const t=Vt.base.group();t.__proto=this;const e=["id","shape","type","category","child"];for(let a of e){let e=this.def[a];b.isString(e)||(g.warn(`create Block: ${a} is not string --`,e),e=""),t.setAttribute("data-"+a,e)}return!0===this.def.draggable&&t.classList.add("ycBlockDraggable"),t}createShape(){}adjust(t){let e=t.modify;e||(e=["data","size","background","transform"]),e.indexOf(!1)&&this.adjustData(t),e.indexOf(!1)&&this.adjustSize(t),e.indexOf(!1)&&this.adjustBackground(t),e.indexOf(!1)&&this.adjustTransform(t)}adjustData(t){}adjustSize(t){}adjustBackground(t){const e=w()(t.dom),a=e.children("path");let n=Object.assign({},t.state.background);a.trigger(Vt.events.background,[n])}adjustTransform(t){const e=w()(t.dom),a=t.state;e.trigger(Vt.events.position,[{translatex:b.isNumber(a.transform.x)?a.transform.x:0,translatey:b.isNumber(a.transform.y)?a.transform.y:0}])}instance(t){var e=new se(this,t);const a=e.element();return a.__instance=e,a.__panel=e.__proto.def.__panel,this.instances.set(e.uid,e),e}}class ue extends de{constructor(t){super(t)}createContainer(){let t=super.createContainer();return"insertmarker"===this.def.id&&t.classList.add("ycBlockInsertionMarker"),t.setAttribute("visibility","hidden"),t}adjustBackground(t){}adjustTransform(t){}instance(t){var e=new oe(this,t);const a=e.element();return a.__instance=e,a.__panel=e.__proto.def.__panel,this.instances.set(e.uid,e),e}}class he extends de{constructor(t){t.state=w.a.extend(!0,{size:{minHeight:40,height:40}},t.state),super(t)}canEmbed(){return!1}isEmbedBlock(){return!0}padding(t){let e=super.padding(t);if(b.isObject(t)){const a=t.state;b.isNull(a.size.padding)&&(e.left=e.right=a.size.height/2)}return e}createShape(){const t=this.def.state;let e={height:t.size.height};w.a.extend(e,t.background);let a=null;return a="diamond"===this.def.shape?Vt.path.diamondRect(e):Vt.path.roundRect(e),a}createElement(){let t=super.createElement(),e=w()(t);return e.append(Vt.base.text()),t}adjustData(t){const e=w()(t.dom),a=t.state;let n=e.children("text");n.trigger(Vt.events.change,[a.data.text])}adjustSize(t){const e=w()(t.dom),a=t.def,n=t.state,i=this.padding(t);let s=this.textWidth(n.data.text);n.size.contentWidth=Math.max(s,n.size.minContentWidth),"dropdown"===a.shape||(n.size.width=Math.max(s,n.size.minContentWidth)+i.left+i.right);let o=e.children("path");o.trigger(Vt.events.resize,[{width:n.size.width,height:n.size.height}]),n.size.width=o[0].__boundbox.width,n.size.height=o[0].__boundbox.height,n.size.contentWidth=o[0].__boundbox.contentWidth,n.size.contentHeight=o[0].__boundbox.contentHeight;let r=e.children("text");r.trigger(Vt.events.positionText,[{x:n.size.width/2,y:0,translatex:0,translatey:n.size.height/2}])}}class pe extends de{constructor(t){t.state=w.a.extend(!0,{size:{minHeight:40,height:40}},t.state),super(t)}canStack(){return!0}isStackBlock(){return!0}canStackPosition(){let t=[];return!1===!!this.def.begin&&t.push("top"),!1===!!this.def.end&&t.push("bottom"),t}stackPosition(){let t=["resolve","reject"];return!1===!!this.def.end&&t.push("top"),!1===!!this.def.begin&&t.push("bottom"),t}canEmbed(){return!0}createElement(){let t=super.createElement();const e=this.def.state;return b.isArray(e.data.sections)?e.data.sections.forEach((e,a)=>{let n=this.createSection(e);n?(e.dom=n,e.dom.setAttribute("data-index",a),t.appendChild(n)):g.warn(`Block<${this.def.id}> createSection failed:`,e)}):(g.warn(`Block<${this.def.id}> has no sections:`,e.data.sections),e.data.sections=[]),t}createSection(t){let e=this,a=null;if("argument"===t.type){if(a=ne.createElement(t),a){let n=w()(a);n.__panel=this.def.__panel,n.on("mousedown",function(){let t=w()(this),e=t.parent();e.hasClass("ycBlockFlyout")||event.stopPropagation()}),"number"===t.datatype||"string"===t.datatype?n.on("mouseup",function(){let t=w()(this),a=t.parent();if(!a.hasClass("ycBlockFlyout")&&(!e.def.__panel.startDrag||!e.def.__panel.selected)&&(event.stopPropagation(),0===event.button)){let e=t.children("path"),a=e[0].getCTM(),n=e[0].getBBox(),i={fill:e.attr("fill"),stroke:e.attr("stroke")},s=t.parent().children("path");s.length>0&&(i.fill=s.attr("fill"),i.stroke=s.attr("stroke")),this.__panel.showInputWidget({dom:this,type:this.__section.datatype,x:Number(a.e),y:Number(a.f),width:n.width+1,height:n.height+1,background:i,value:this.__section.data.value,callback:t=>{"number"===this.__section.datatype&&""===t&&(t=0),this.__section.data.value=t,this.__instance.update(null,{force:!0})}})}}):"enum"===t.datatype&&n.on("mouseup",function(){let t=w()(this),a=t.parent();if(!a.hasClass("ycBlockFlyout")&&(!e.def.__panel.startDrag||!e.def.__panel.selected)&&(event.stopPropagation(),0===event.button)){let e=t.children("path"),a=e[0].getCTM(),n=e[0].getBBox(),i={fill:e.attr("fill"),stroke:e.attr("stroke")},s=t.parent().children("path");s.length>0&&(i.fill=s.attr("fill"),i.stroke=s.attr("stroke")),this.__panel.showDropdownWidget({dom:this,type:this.__section.datatype,center:Number(a.e)+n.width/2*Number(a.a),bottom:Number(a.f)+n.height*Number(a.d),top:Number(a.f),background:i,select:this.__section.data.currentIndex,values:this.__section.data.values,callback:t=>{this.__section.data.currentIndex=t,this.__instance.update(null,{force:!0})}})}})}}else"text"===t.type?a=Vt.base.text(t):"image"===t.type&&(t.width||(t.width=0),t.height||(t.height=0),a=Vt.group.image(t));return a}adjustBackground(t){const e=t.state;for(let a of e.data.sections)if("argument"===a.type&&a.dom){let t=w()(a.dom),n={};e.background&&(e.background.stroke&&(n.stroke=e.background.stroke),a.data.background.chameleon&&(n.fill=e.background.stroke),t.trigger(Vt.events.background,[n]))}}adjustData(t){const e=t.state;for(let a of e.data.sections)if("argument"===a.type&&a.dom){a.dom.__panel=t.def.__panel;let e=ne.argument(a);e.adjust(),a.__assign?(e.hide(),a.__assign.update()):e.show()}}adjustSize(t){const e=w()(t.dom),a=t.def,n=this.padding(t),i=t.state,s=i.data.sections;let o=i.size.space,r=n.left,l=n.top,c=20;for(let u of s.values())"argument"===u.type&&u.dom?u.__assign?(u.__width=u.__assign.layoutWidth(),c=Math.max(c,u.__assign.layoutHeight())):(u.__width=u.data.size.width,c=Math.max(c,u.data.size.height)):"text"===u.type&&u.dom?u.__width=this.textWidth(u.text):"image"===u.type&&u.dom&&(u.__width=u.width),r+=u.__width,r+=o;r-=o;let d=e.children("path");"round"===a.shape||"diamond"===a.shape?(i.size.width=r+n.right,i.size.height=c+n.top+n.bottom,d.trigger(Vt.events.resize,[{width:i.size.width,height:i.size.height}])):(i.size.contentWidth=r+n.right,i.size.contentHeight=c+n.top+n.bottom,d.trigger(Vt.events.resize,[{contentWidth:i.size.contentWidth,contentHeight:i.size.contentHeight}])),i.size.width=d[0].__boundbox.width,i.size.height=d[0].__boundbox.height,i.size.contentWidth=d[0].__boundbox.contentWidth,i.size.contentHeight=d[0].__boundbox.contentHeight,c=i.size.height-n.top-n.bottom,r=n.left;for(let u of s){let t=null;if("argument"===u.type&&u.dom)if(u.__assign)u.__assign.update({transform:{x:r,y:(c-u.__assign.layoutHeight())/2+n.top}});else{let t=ne.argument(u);t.translate(r,(c-u.data.size.height)/2+n.top)}else"text"===u.type&&u.dom?(t=w()(u.dom),t.trigger(Vt.events.positionText,[{x:u.__width/2,y:0,translatex:r,translatey:c/2+n.top}])):"image"===u.type&&u.dom&&(t=w()(u.dom),t.trigger(Vt.events.position,[{translatex:r,translatey:(c-u.height)/2+n.top}]));r+=u.__width,r+=o}l=i.size.height,e.children('g.ycBlockDraggable[data-child=""]').each(function(){let t=null;t="insertmarker"===this.getAttribute("data-id")?a.__panel.marker:a.__panel.instances[this.getAttribute("data-uid")],t.setTranslate(0,l),l+=t.layoutHeight()})}instance(t){const e=super.instance(t),a=e.state.data.sections,n=w()(e.element());return n.children().each(function(){const t=this.getAttribute("data-index");if(t){const n=a[t];n.dom=this,n.dom.__panel=e.__proto.def.__panel,n.dom.__section=a[t],n.dom.__instance=e}}),e}}class me extends pe{constructor(t){super(t)}canStack(){return!1}isStackBlock(){return!1}canStackPosition(){return[]}stackPosition(){return[]}canEmbed(){return!0}isEmbedBlock(){return!0}createShape(){let t=Object.assign({},this.def.state.background),e=null;return e="diamond"===this.def.shape?Vt.path.diamondRect(t):Vt.path.roundRect(t),e}padding(t){let e=super.padding(t);return e}}class ge extends pe{constructor(t){t.state=w.a.extend(!0,{size:{space:8,padding:{left:8,right:8,top:8,bottom:4},contentHeight:40,minContentHeight:40}},t.state),super(t)}canStackPosition(){let t=super.canStackPosition();return t.push("resolve"),"cuptwo"===this.def.shape&&t.push("reject"),t}createElement(){const t=super.createElement(),e=this.def.state;if("cuptwo"===this.def.shape&&e.data.other&&"text"===e.data.other.type){let a=Vt.base.text(e.data.other);a.classList.add("ycBlockOther"),t.appendChild(a)}if(e.data.subscript){let a=e.data.subscript;a.width||(a.width=0),a.height||(a.height=0);let n=Vt.group.image(a);n.classList.add("ycBlockSubscript"),t.appendChild(n)}return t}createShape(){let t=Object.assign({},this.def.state.background);t.end=!!this.def.end;let e=null;return"cup"===this.def.shape?e=Vt.path.cup(t):"cuptwo"===this.def.shape&&(e=Vt.path.cuptwo(t)),e}adjustSize(t){const e=w()(t.dom),a=t.def,n=this.padding(t),i=t.state,s=i.data.sections;let o=i.size.space,r=20,l=0;for(let g of s.values())"argument"===g.type&&g.dom?g.__assign?(g.__width=g.__assign.layoutWidth(),r=Math.max(r,g.__assign.layoutHeight())):(g.__width=g.data.size.width,r=Math.max(r,g.data.size.height)):"text"===g.type&&g.dom?g.__width=this.textWidth(g.text):"image"===g.type&&g.dom&&(g.__width=g.width),l+=g.__width,l+=o;if(l-=o,"cuptwo"===a.shape&&i.data.other){const t=i.data.other;t.__width=0,"text"===t.type&&(t.__width=this.textWidth(t.text)),l=Math.max(l,t.__width)}let c=0;e.children('g.ycBlockDraggable[data-child="resolve"]').each(function(){let t=null;t="insertmarker"===this.getAttribute("data-id")?a.__panel.marker:a.__panel.instances[this.getAttribute("data-uid")],c+=t.sequenceHeight()});let d=0;"cuptwo"===a.shape&&e.children('g.ycBlockDraggable[data-child="reject"]').each(function(){let t=null;t="insertmarker"===this.getAttribute("data-id")?a.__panel.marker:a.__panel.instances[this.getAttribute("data-uid")],d+=t.sequenceHeight()});let u=e.children("path");i.size.contentWidth=l+n.right+n.left,i.size.contentHeight=r+n.top+n.bottom,"cup"===a.shape?u.trigger(Vt.events.resize,[{contentWidth:i.size.contentWidth,contentHeight:i.size.contentHeight,slotHeight:c}]):"cuptwo"===a.shape&&u.trigger(Vt.events.resize,[{contentWidth:i.size.contentWidth,contentHeight:i.size.contentHeight,slotHeight:[c,d]}]),i.size.width=u[0].__boundbox.width,i.size.height=u[0].__boundbox.height,i.size.contentWidth=u[0].__boundbox.contentWidth,i.size.contentHeight=u[0].__boundbox.contentHeight,i.size.cornerRadius=u[0].__boundbox.cornerRadius,i.size.bottomHeight=u[0].__boundbox.bottomHeight,"cup"===a.shape?i.size.resolveHeight=u[0].__boundbox.slotHeight:"cuptwo"===a.shape&&(i.size.centerHeight=u[0].__boundbox.centerHeight,i.size.resolveHeight=u[0].__boundbox.slotHeight[0],i.size.rejectHeight=u[0].__boundbox.slotHeight[1]),i.size.wholeHeight=u[0].__boundbox.wholeHeight,r=i.size.height-n.top-n.bottom;let h=n.top,p=n.left;for(let g of s){let t=null;if("argument"===g.type&&g.dom)if(g.__assign)g.__assign.update({transform:{x:p,y:(r-g.__assign.layoutHeight())/2+n.top}});else{let t=ne.argument(g);t.translate(p,(r-g.data.size.height)/2+n.top)}else"text"===g.type&&g.dom?(t=w()(g.dom),t.trigger(Vt.events.positionText,[{x:g.__width/2,y:0,translatex:p,translatey:r/2+n.top}])):"image"===g.type&&g.dom&&(t=w()(g.dom),t.trigger(Vt.events.position,[{translatex:p,translatey:(r-g.height)/2+n.top}]));p+=g.__width,p+=o}h=i.size.height;let m=h;if(e.children('g.ycBlockDraggable[data-child="resolve"]').each(function(){let t=null;t="insertmarker"===this.getAttribute("data-id")?a.__panel.marker:a.__panel.instances[this.getAttribute("data-uid")],t.setTranslate(16,m),m+=t.sequenceHeight()}),h+=i.size.resolveHeight,"cuptwo"===a.shape&&i.data.other){h+=i.size.cornerRadius;let t=e.children(".ycBlockOther");t.trigger(Vt.events.positionText,[{x:n.left+i.data.other.__width/2,y:0,translatex:0,translatey:h+i.size.centerHeight/2}]),h+=i.size.centerHeight,h+=i.size.cornerRadius;let s=h;e.children('g.ycBlockDraggable[data-child="reject"]').each(function(){let t=null;t="insertmarker"===this.getAttribute("data-id")?a.__panel.marker:a.__panel.instances[this.getAttribute("data-uid")],t.setTranslate(16,s),s+=t.sequenceHeight()}),h+=i.size.rejectHeight}if(i.data.subscript){h+=i.size.cornerRadius;let t=e.children(".ycBlockSubscript");t.trigger(Vt.events.position,[{translatex:i.size.width-n.right-i.data.subscript.width,translatey:i.size.wholeHeight-i.size.bottomHeight-i.size.cornerRadius+(i.size.bottomHeight-i.data.subscript.height)/2}])}h=i.size.wholeHeight,e.children('g.ycBlockDraggable[data-child=""]').each(function(){let t=null;t="insertmarker"===this.getAttribute("data-id")?a.__panel.marker:a.__panel.instances[this.getAttribute("data-uid")],t.setTranslate(0,h),h+=t.layoutHeight()})}}class fe extends pe{constructor(t){t.state=w.a.extend(!0,{size:{space:8,padding:{left:8,right:8,top:8,bottom:4},contentHeight:40,minContentHeight:40}},t.state),super(t)}createShape(){let t=Object.assign({},this.def.state.background);t.end=!!this.def.end;let e=Vt.path.slot(t);return e}}class ye extends fe{constructor(t){super(t)}stackPosition(){return["top"]}createShape(){let t=Object.assign({},this.def.state.background),e=null;return e="hat"===this.def.shape?Vt.path.hat(t):Vt.path.cap(t),e}}const be={createPrototype:function(t){if(!t.type)return null;let e=null;return"variant"===t.type?e=new he(t):"marker"===t.type?e=new ue(t):"action"===t.type?e=new fe(t):"event"===t.type?e=new ye(t):"express"===t.type?e=new me(t):"control"===t.type?e=new ge(t):g.warn(`createPrototype failed: unkown type -- ${t.type}`),e}};var ve=be;function xe(t){return Nt.categories?Nt.categories[t]:null}const ke=.5,we=2;class _e{constructor(t){this.dom={},this.dom.root=t;let e=w()(t),a=e.children(".ycBlockSvg");this.dom.svg=a[0],this.dom.info=a.find("#ycBlockInfo")[0],this.dom.canvas=a.find(".ycBlockCanvas")[0],this.dom.bubblecanvas=e.find(".ycBlockBubbleCanvas")[0],this.dom.dragsurface=e.find(".ycBlockDragSurface")[0],this.dom.dragcanvas=e.find(".ycBlockDragCanvas")[0],this.dom.canvasList=[this.dom.canvas,this.dom.bubblecanvas,this.dom.dragcanvas];let n=e.find(".ycBlockFlyout");this.dom.flyout=n[0],this.dom.flyoutcanvas=n.find(".ycBlockCanvas")[0],this.dom.flyoutbubblecanvas=n.find(".ycBlockBubbleCanvas")[0],this.dom.flyoutcanvasList=[this.dom.flyoutcanvas,this.dom.flyoutbubblecanvas],this.dom.menu=e.find(".ycBlockCategoryMenu")[0],this.dom.widget=e.find(".ycBlockWidgetDiv")[0],this.dom.dropdown=e.find(".ycBlockDropDownDiv")[0],this.dom.tooltip=e.find(".ycBlockTooltipDiv")[0],this.dom.buttons=e.find(".ycBlockButtons")[0],this.marker=null,this.registries={},this.instances={},this.grapPoint={x:0,y:0},this.lastPoint={x:0,y:0},this.selected=null,this.zoomRate=1.2,this.currentZoomFactor=1/this.zoomRate,this.startDrag=!1,this.flyoutgrapPoint={x:0,y:0},this.flyoutlastPoint={x:0,y:0},this.flyoutselected=null,this.flyoutstartDrag=!1,this.flyoutZoomFactor=.5,this.flyoutHeight=0,this.option={width:800,height:600,blocks:Nt,buttons:[{id:"zoomout",img:"/img/zoom-out.svg",action:()=>{this.zoomCanvas(this.currentZoomFactor/this.zoomRate)}},{id:"zoomin",img:"/img/zoom-in.svg",action:()=>{this.zoomCanvas(this.currentZoomFactor*this.zoomRate)}},{id:"reset",img:"/img/zoom-reset.svg",action:()=>{this.resetCanvas()}}]},this.setCanvasTransfrom(this.dom.canvasList,"scale("+this.currentZoomFactor+")"),this.setCanvasTransfrom(this.dom.flyoutcanvasList,"scale("+this.flyoutZoomFactor+")"),w()(this.dom.root).on("mousedown",()=>{this.hideDropdownWidget(),this.hideWidget()}),w()(this.dom.dropdown).on("mousedown",()=>{event.stopPropagation()}).on("mouseup",()=>{event.stopPropagation()}),w()(this.dom.widget).on("mousedown",()=>{event.stopPropagation()}).on("mouseup",()=>{event.stopPropagation()}),this.bindCanvasEvent()}zoomCanvas(t){if(!t)return void g.warn("Panel zoomCanvas failed: zoom is null");if(t<ke||t>we)return;this.currentZoomFactor=t;let e=this.dom.canvas.getCTM(),a="translate("+Number(e.e)+","+Number(e.f)+") scale("+this.currentZoomFactor+")";this.setCanvasTransfrom(this.dom.canvasList,a)}resetCanvas(){this.currentZoomFactor=1,this.setCanvasTransfrom(this.dom.canvasList,"translate(0,0) scale(1.0)")}bindCanvasEvent(){let t=this;w()(this.dom.svg).on("mousedown",()=>{0===event.button&&(this.lastPoint.x=event.pageX,this.lastPoint.y=event.pageY,this.startDrag=!0,w()(this.dom.flyout).css("pointer-events","none"))}).on("mousemove",function(){let e=w()(this).offset().left,a=w()(this).offset().top,n=t.dom.canvas.getCTM();t.updateInfo({x:Math.round((event.pageX-e-Number(n.e))/Number(n.a)),y:Math.round((event.pageY-a-Number(n.f))/Number(n.d))});let i=event.pageX-t.lastPoint.x,s=event.pageY-t.lastPoint.y;if(!t.selected&&t.startDrag){t.lastPoint.x=event.pageX,t.lastPoint.y=event.pageY;let e=t.dom.canvas.getCTM(),a="translate("+(Number(e.e)+i)+","+(Number(e.f)+s)+") scale("+t.currentZoomFactor+")";t.setCanvasTransfrom(t.dom.canvasList,a)}else if(t.selected){let e=w()(t.selected),a=w()(t.selected).attr("data-uid"),n=t.instances[a];if(e.hasClass("ycBlockSelected")&&!e.hasClass("ycBlockDragging")){t.marker.ghost(n);let a=w()(t.marker.element());a.attr("visibility","hidden"),n.__proto.isStackBlock()?(t.marker.childType(n.childType()),a.insertAfter(e)):n.__proto.isEmbedBlock()?(t.marker.childType(""),w()(t.dom.canvas).append(a)):g.warn("mouse move: unknown block type");let i=n.prevBlock();if(i){let s=t.viewPortOffset(),o=e[0].getCTM(),r=(Number(o.e)-s.x)/Number(o.a),l=(Number(o.f)-s.y)/Number(o.d);if(e.attr("transform",`translate(${r},${l})`),n.__proto.isEmbedBlock()){a.attr("transform",`translate(${r},${l})`);const t=i.state.data.sections;for(let e of t)if(e.__assign===n){e.__assign=null;break}}}w()(t.dom.dragsurface).css("display","block"),w()(t.dom.dragcanvas).append(e),n.childType(""),e.addClass("ycBlockDragging"),i&&i.update(null,{force:!0,prev:!0})}w()(t.dom.dragsurface).attr("style","display: block; transform: translate3d("+i+"px,"+s+"px,0px)");let o=t.selected.getBBox(),r=t.selected.getCTM(),l=(i+t.grapPoint.x)/Number(r.a),c=(s+t.grapPoint.y)/Number(r.d);const d=function(t,e,a){return{left:t+a.x,top:e+a.y,right:t+a.x+a.width/2,bottom:e+a.y+a.height}};let u=d(l,c,o),h=[];for(let i of Object.values(t.instances)){if("insertmarker"===i.__proto.id)continue;if(i.__proto.isInternal())continue;if(n.hasInclude(i))continue;if(n.__proto.isStackBlock()&&!i.__proto.canStack())continue;if(n.__proto.isEmbedBlock()&&!i.__proto.canEmbed())continue;let t=i.getRegions(),e={};if(n.__proto.isEmbedBlock()&&t.arguments){e.index=-1;for(let[a,i]of Object.entries(t.arguments))n.__proto.def.shape===i.shape&&n.stateData().datatype===i.datatype&&Yt.isIntersects(u,i.rect)&&(e.index<0||i.rect.left<e.rect.left)&&(e.index=a,e.rect=i.rect);e.index>=0&&h.push({instance:i,region:e})}else if(n.__proto.isStackBlock()&&t.stacks){e.position="";let a=n.stackPosition(!0);for(let[s,o]of Object.entries(t.stacks))if(!(a.indexOf(s)<0)&&("top"!==s||!i.prevBlock())){if("bottom"===s){const t=i.nextBlock();if(t&&"insertmarker"!==t.protoId()){let t=n.lastBlock().__proto.canStackPosition();if(t.indexOf("bottom")<0)continue}}Yt.isIntersects(u,o)&&(""===e.position||o.top<e.rect.top)&&(e.position=s,e.rect=o)}""!==e.position&&h.push({instance:i,region:e})}}let p=null;if(h.length>0)if(n.__proto.isEmbedBlock())for(let t of h)p?t.region.rect.left<p.region.rect.left&&(p=t):p=t;else if(n.__proto.isStackBlock())for(let t of h.reverse())p?t.region.rect.top<p.region.rect.top&&(p=t):p=t;p&&(n.__proto.isEmbedBlock()?p.insert=Number(p.region.index):n.__proto.isStackBlock()&&(p.insert=p.region.position));let m=w()(t.marker.element()),f=t.marker.hostInstance;if(g.debug("marker oldhost======",f?f.instance.__proto.def.id+"--"+f.insert:null),g.debug("marker newhost======",p?p.instance.__proto.def.id+"--"+p.insert:null),n.__proto.isEmbedBlock())if(m.attr("visibility","hidden"),f)if(p){if(f.instance!==p.instance||f.insert!==p.insert){let t=f.instance.state.data.sections[f.insert],e=ne.argument(t);e.highlight(!1);let a=p.instance.state.data.sections[p.insert],n=ne.argument(a);n.highlight()}}else{let t=f.instance.state.data.sections[f.insert],e=ne.argument(t);e.highlight(!1),m.attr("transform",`translate(${l},${c})`)}else if(p){let t=p.instance.state.data.sections[p.insert],e=ne.argument(t);e.highlight()}else m.attr("transform",`translate(${l},${c})`);else if(n.__proto.isStackBlock())if(f)if(p){if(f.instance!==p.instance||f.insert!==p.insert){if(t.marker.pop(),"top"===f.insert){let t=f.instance.prevBlock();t&&t.update(null,{force:!0,prev:!0})}if(f.instance===p.instance&&"resolve"!==f.insert&&"reject"!==f.insert||f.instance.update(null,{force:!0,prev:!0}),"bottom"===p.insert)p.instance.next(t.marker);else if("top"===p.insert){let e=p.instance.prevBlock();if(e)e.next(t.marker),e.update(null,{force:!0,prev:!0});else{let e=t.viewPortOffset(),a=p.instance.element().getCTM(),n=(Number(a.e)-e.x)/Number(a.a)-t.marker.ghostOffset.x,i=(Number(a.f)-e.y)/Number(a.d)-t.marker.ghostOffset.y;t.marker.childType(""),m.attr("transform",`translate(${n},${i})`),t.marker.next(p.instance),w()(t.dom.canvas).append(m)}}else"resolve"===p.insert?p.instance.resolve(t.marker):"reject"===p.insert&&p.instance.reject(t.marker);t.marker.update(),p.instance.update(null,{force:!0,prev:!0})}}else if(m.attr("visibility","hidden"),t.marker.pop(),t.marker.childType(""),w()(t.dom.canvas).append(m),m.attr("transform",`translate(${l},${c})`),"bottom"!==f.insert){let t=f.instance.prevBlock();t&&t.update(null,{force:!0,prev:!0}),f.instance.update()}else f.instance.update(null,{force:!0,prev:!0});else if(p){if("bottom"===p.insert)p.instance.next(t.marker),p.instance.update(null,{force:!0,prev:!0});else if("top"===p.insert){let e=p.instance.prevBlock();if(e)e.next(t.marker),e.update(null,{force:!0,prev:!0});else{let e=t.viewPortOffset(),a=p.instance.element().getCTM(),n=(Number(a.e)-e.x)/Number(a.a)-t.marker.ghostOffset.x,i=(Number(a.f)-e.y)/Number(a.d)-t.marker.ghostOffset.y;m.attr("transform",`translate(${n},${i})`),t.marker.childType(""),t.marker.next(p.instance),w()(t.dom.canvas).append(m)}}else"resolve"===p.insert?(p.instance.resolve(t.marker),p.instance.update(null,{force:!0,prev:!0})):"reject"===p.insert&&(p.instance.reject(t.marker),p.instance.update(null,{force:!0,prev:!0}));t.marker.update(),m.attr("visibility","visible")}else m.attr("visibility","hidden"),m.attr("transform",`translate(${l},${c})`);t.marker.hostInstance=p}}).on("mouseup mouseleave",()=>{t.startDrag=!1,w()(this.dom.flyout).css("pointer-events","auto");let e=w()(t.dom.dragsurface);if(t.selected){let n=w()(t.selected),i=n.attr("data-uid");if(n.hasClass("ycBlockSelected")&&n.hasClass("ycBlockDragging")){var a=w()(t.marker.element());if(this.isInFlyoutRegion(event.pageX,event.pageY))this.removeBlock(i);else{let e=w()(t.selected).attr("data-uid"),i=t.instances[e];if(i.__proto.isStackBlock()){let e=t.marker.childType();i.childType(e);const s=i.layoutHeight(),o=i.sequenceHeight();let r=t.marker.prevBlock(),l=t.marker.nextBlock();r?(t.marker.pop(),"resolve"===e?r.resolve(i):"reject"===e?r.reject(i):r.next(i)):(l&&i.last(l),n.insertBefore(a));let c=a.attr("transform").replace(/[^0-9\-.,]/g,"").split(",");l?i.update({transform:{x:Number(c[0]),y:Number(c[1])+s-o}}):i.update({transform:{x:Number(c[0]),y:Number(c[1])}})}else if(i.__proto.isEmbedBlock()){let e=t.marker.hostInstance;if(e){let t=e.instance.state.data.sections[e.insert],a=ne.argument(t);a.highlight(!1),i.childType("argument"),w()(e.instance.element()).append(n),t.__assign=i,e.instance.update(null,{force:!0,prev:!0})}else{i.childType(""),n.insertBefore(a);let e=a.attr("transform").replace(/[^0-9\-.,]/g,"").split(",");t.selected.__instance.update({transform:{x:Number(e[0]),y:Number(e[1])}})}}n.removeClass("ycBlockDragging"),n.removeClass("ycBlockSelected"),i.update(null,{force:!0,prev:!0,next:!0})}t.marker.ghost(null),e.css("display","none"),e.attr("style","transform: translate3d(0px,0px,0px)")}t.selected=null}}),w()(this.dom.flyout).on("mousedown",()=>{0===event.button&&(this.flyoutlastPoint.x=event.pageX,this.flyoutlastPoint.y=event.pageY,this.flyoutstartDrag=!0)}).on("mousemove",function(){let e=w()(this),a=event.pageY-t.flyoutlastPoint.y;if(!t.flyoutselected&&t.flyoutstartDrag){t.flyoutlastPoint.x=event.pageX,t.flyoutlastPoint.y=event.pageY;let n=t.dom.flyoutcanvas.getCTM(),i=Number(n.f)+a;i>0&&(i=0);let s=Number(e.attr("height")),o=(s-t.flyoutHeight)*t.flyoutZoomFactor;i<o&&(i=o);let r="translate(0,"+i+") scale("+t.flyoutZoomFactor+")";t.setCanvasTransfrom(t.dom.flyoutcanvasList,r)}else if(t.flyoutselected){let a=w()(t.flyoutselected).attr("data-id"),i=t.registries[a],s=w()(t.dom.svg).offset(),o=s.left,r=s.top,l=t.dom.canvas.getCTM(),c=t.flyoutselected.getBBox();t.grapPoint.x=(event.pageX-o-Number(l.e))/Number(l.a)-(c.width/2+c.x),t.grapPoint.y=(event.pageY-r-Number(l.f))/Number(l.a)-(c.height/2+c.y);let d=t.addBlock({type:i.def.id,state:{transform:{x:t.grapPoint.x,y:t.grapPoint.y}}},t.dom.dragcanvas);t.grapPoint.x*=Number(l.a),t.grapPoint.y*=Number(l.d),t.selected=d.element(),w()(t.selected).addClass("ycBlockSelected ycBlockDragging"),t.marker.ghost(d);var n=w()(t.marker.element());n.attr("visibility","hidden"),w()(t.dom.canvas).append(n),t.flyoutselected=null,t.lastPoint.x=event.pageX,t.lastPoint.y=event.pageY;let u=event.pageX-t.lastPoint.x,h=event.pageY-t.lastPoint.y,p=w()(t.dom.dragsurface);p.attr("style","transform: translate3d("+u+"px,"+h+"px,0px)"),p.css("display","block"),t.startDrag=!0,e.css("pointer-events","none")}}).on("mouseup mouseleave",()=>{this.flyoutstartDrag=!1,this.flyoutselected=null})}viewPortOffset(){let t=this.dom.canvas.getCTM();return{x:Number(t.e),y:Number(t.f)}}viewPortBoundbox(){let t=this.dom.canvas.getCTM();return{left:Number(t.e)*Number(t.a),top:Number(t.f)*Number(t.d),right:(Number(t.e)+w()(this.dom.svg).attr("width"))*Number(t.a),bottom:(Number(t.f)+w()(this.dom.svg).attr("height"))*Number(t.d)}}isInFlyoutRegion(t,e){let a=w()(this.dom.flyout).find(".ycBlockFlyoutBackground"),n=a[0].getBBox(),i=a[0].getScreenCTM(),s=i.e+n.x,o=s+n.width,r=i.f+n.y,l=r+n.height;return t>=s&&t<=o&&e>=r&&e<=l}updateInfo(t){w()(this.dom.info).html(`X: ${t.x} Y: ${t.y}`)}setCanvasTransfrom(t,e){t.forEach(function(t){w()(t).attr("transform",e)})}processPackage(t){this.option.blocks.defs||(this.option.blocks.defs={variant:{name:"变量",members:[]},marker:{name:"标记",members:[]},action:{name:"动作",members:[]},event:{name:"事件",members:[]},express:{name:"表达式",members:[]},control:{name:"控制",members:[]}});let e=this.option.blocks.defs;if(b.isArray(t))for(const a of t){let t=a.type;e[t]&&(e[t].members=e[t].members.concat(a))}else if(b.isObject(t))for(let[a,n]of Object.entries(t))b.isArray(n)&&e[a]&&(e[a].members=e[a].members.concat(n))}setOption(t){g.debug("$$$$$$$$$$$$$",t),this.option.blocks.defs=null;let e=[].concat(this.option.buttons,t.buttons);delete t["buttons"],w.a.extend(!0,this.option,t),this.option.buttons=e,g.debug("$$$$$$$$$$$$$",t);for(let i of this.option.blocks.packages.values())this.processPackage(i);let a=this.option.blocks.defs,n=this.option.blocks.categories;for(let i of Object.values(n))i.blocks=[];for(let[i,s]of Object.entries(a))for(let t of s.members.values())t.type=i,this.registerBlock(t,n);this.prepare()}prepare(){this.marker=this.createBlockInstance("insertmarker"),this.initCategoryToolbox(),this.initButtons()}initButtons(){const t=w()(this.dom.buttons);t.children().remove();let e=0;for(let a of this.option.buttons){let n=Vt.base.image({width:36,height:36,y:e,url:a.img});w()(n).attr("data-id",a.id);let i=this;w()(n).mousedown(function(){b.isFunction(a.action)&&a.action(i)}),t.append(n),e+=44}}initCategoryToolbox(){const t=this.option.blocks.categories,e=this.registries;let a=this.flyoutZoomFactor,n=this;function i(e,n){let i=t[e];if(!i)return void g.warn("category can not found: "+e);let s=i.state;var o=w()('<div class="ycBlockCategoryMenuRow"></div>'),r=w()(`<div class="ycBlockCategoryMenuItem" data-id="${e}"></div>`);r.append(w()(`<div class="ycBlockCategoryItemBubble" style="background-color: ${s.background.fill}; border-color: ${s.background.stroke};"></div>`)),r.append(w()(`<div class="ycBlockCategoryMenuItemLabel">${i.name}</div>`)),o.append(r);let l="translate(0,"+-n*a+") scale("+a+")";return r.on("click",function(){V["a"](".ycBlockFlyout>.ycBlockWorkspace>g").transition().duration(500).attr("transform",l)}),o}let s=12,o=s,r=64,l=w()(this.dom.menu),c=w()(this.dom.flyoutcanvas);w.a.each(t,function(a,d){if(!d.display||"none"!==d.display){let u=i(a,o-s);t[a].menuitem=u[0],l.append(u);let h=Yt.computeTextLength(d.name)+16,p=Vt.group.flyoutLabel({text:d.name,width:h,height:40,translatex:20,translatey:o});t[a].flyoutlable=p[0],c.append(p),o+=r,d.blocks&&w.a.each(d.blocks,function(t,a){let i=e[a];if(i&&i.prototypeElement){let t=w()(i.prototypeElement).clone(!0);t.addClass("ycBlockFlyout"),c.append(t);let e=t[0].getBBox();o+=-e.y,t.attr("transform",`translate(36, ${o})`),o+=e.height+16,t.on("mousedown",function(){n.flyoutselected=this}).on("mouseup",function(){n.startDrag||(n.flyoutselected=null)})}else g.warn("block registry is corrupted:"+a)})}}),this.flyoutHeight=o}createBlockInstance(t,e){if(!this.hasRegistered(t))return void g.warn("block is unregistered: "+t);let a=this.registries[t],n=a.instance(e);return this.instances[n.uid]=n,n}removeBlock(t){if(!b.isString(t))return void g.warn("removeBlock failed: wrond uid - ",t);let e=this.instances[t];e?(e.clear(),delete this.instances[t]):g.warn("removeBlock failed: can not found uid - ",t)}showInputWidget(t){if(!t)return void this.hideWidget();let e=w()(this.dom.widget);e.children().remove();let a=this,n=null,i=t.dom;e.addClass("fieldTextInput"),e.attr("style","transition: box-shadow 0.25s ease 0s;box-shadow: rgba(255, 255, 255, 0.3) 0px 0px 0px 4px;"),e.css("border-color",t.background.stroke),e.css("transform",`scale(${a.currentZoomFactor})`),e.css("top",t.y),e.css("left",t.x),e.css("width",t.width),e.css("height",t.height),n=w()('<input class="ycBlockHtmlInput" spellcheck="true" value="">'),n.attr("type","text"),n.val(t.value),n.on("input",function(){let a=w()(this).val();"number"===t.type&&(a=a.replace(/[^\d.]/g,"")),w()(this).val(a),s&&s(a),e.css("width",i.__section.data.size.width)});let s=t.callback;n.on("blur",function(){let t=w()(this).val();s&&s(t),a.hideWidget()}),e.append(n),e.css("display","block"),n.focus()}hideWidget(){let t=w()(this.dom.widget);t.attr("class","ycBlockWidgetDiv"),t.attr("style",""),t.children().remove()}showDropdownWidget(t){if(!t)return void this.hideDropdownWidget();let e=w()(this.dom.dropdown),a=e.children(".ycBlockDropDownContent");a.children().remove();let n=this;e.attr("style","transition: opacity 0.25s ease 0s;"),e.css("border-color",t.background.stroke),e.css("background-color",t.background.fill);const i=function(t){let e=w()('<div class="ycBlockDropDownMenu" role="menu" aria-haspopup="true" tabindex="0" style="user-select: none;">');return t.values.forEach((a,i)=>{let s=w()(`<div class="ycBlockDropDownMenuItem" role="menuitemcheckbox" style="user-select: none;" data-index="${i}" data-value="${a.value}"></div>`),o=w()(`<div class="ycBlockDropDownMenuItemContent" style="user-select: none;"><div class="ycBlockMenuItemCheckBox" style="user-select: none;"></div>${a.name}</div>`);i===t.select&&o.addClass("ycBlockSelected");let r=t.callback;s.on("mouseover",function(){w()(this).addClass("ycBlockDropDownMenuItemHover")}).on("mouseout",function(){w()(this).removeClass("ycBlockDropDownMenuItemHover")}).on("mousedown",function(){event.stopPropagation();let t=w()(this).attr("data-index"),e=w()(this).attr("data-value");r&&r(Number(t),Number(e)),n.hideDropdownWidget()}),s.append(o),e.append(s)}),e};let s=i(t);a.append(s);let o=e.children(".ycBlockDropDownArrow"),r=e.outerWidth()/2,l=e.outerHeight(),c=w()(this.dom.svg).find(".ycBlockWorkspace"),d=c[0].getBBox();t.bottom+l>d.height?(e.css("transform","translate(0px, -20px)"),e.css("top",t.top-l),e.css("left",t.center-r),o.removeClass("ycBlockArrowTop"),o.addClass("ycBlockArrowBottom"),o.attr("style",`transform: translate(${r-9}px, ${l-9}px) rotate(45deg);`)):(e.css("transform","translate(0px, 20px)"),e.css("top",t.bottom),e.css("left",t.center-r),o.removeClass("ycBlockArrowBottom"),o.addClass("ycBlockArrowTop"),o.attr("style",`transform: translate(${r-9}px, -9px) rotate(45deg);`)),e.css("opacity","1"),e.css("display","block")}hideDropdownWidget(){let t=w()(this.dom.dropdown);t.attr("class","ycBlockDropDownDiv"),t.attr("style","display: none; opacity: 0;");let e=t.children(".ycBlockDropDownContent");e.children().remove()}addBlock(t,e){if(!t||!t.type)return;let a=this.createBlockInstance(t.type,t.state);if(!a)return;let n=this,i=n.dom,s=w()(i.svg),o=w()(a.element());return o.attr("data-uid",a.uid),o.on("mousedown",function(){if(event.stopPropagation(),0===event.button){n.hideWidget(),n.selected=this;let t=this.getCTM(),e=i.canvas.getCTM();n.grapPoint.x=Number(t.e)-Number(e.e),n.grapPoint.y=Number(t.f)-Number(e.f),w()(n.selected).addClass("ycBlockSelected"),n.lastPoint.x=event.pageX,n.lastPoint.y=event.pageY,n.startDrag=!0,w()(n.dom.flyout).css("pointer-events","none")}else if(2===event.button){let t=s.offset().left,e=s.offset().top,a=w()(this).attr("data-uid"),i=n.instances[a];if(i.dump(),!i.__proto.isInternal()){let s=[{id:"copy",name:"复制",action:()=>{n.cloneBlock(a,!0)}},{id:"copyself",name:"复制自己",action:()=>{n.cloneBlock(a)}},{id:"delete",name:"删除",action:()=>{n.removeBlock(a)}}];for(let t of i.exportItems()){const e=t.ext,a=t.fmt;!0===t.menuItem&&s.push({id:"export@"+a,name:t.menuName?t.menuName:"导出"+a,action:()=>{let t=i.export(a);g.debug("MENU ACTION",t),n.option.exportCallback&&n.option.exportCallback(n,e,t)}})}n.showContextMenu({x:event.pageX-t,y:event.pageY-e,items:s})}}n.hideDropdownWidget()}).on("mouseup",function(){2===event.button&&event.stopPropagation()}),e?w()(e).append(o):w()(this.dom.canvas).append(o),a}showContextMenu(t){if(!t||!b.isArray(t.items)||0===t.items.length)return void this.hideWidget();let e=w()(this.dom.widget);e.children().remove();let a=this,n=null;e.attr("style","direction: ltr;"),e.css("top",t.y),e.css("left",t.x),n=w()('<div class="ycBlockContextMenu" role="menu" aria-haspopup="true" tabindex="0" style="user-select: none;"></div>');for(let i of t.items){let t=w()(`<div class="ycBlockContextMenuItem" role="menuitem" id="cm-${i.id}" style="user-select: none;"><div class="ycBlockContextMenuItemContent" style="user-select: none;">${i.name}</div></div>`);t.on("mouseover",function(){w()(this).addClass("ycBlockContextMenuItemHover")}).on("mouseout",function(){w()(this).removeClass("ycBlockContextMenuItemHover")}).on("mousedown",function(){event.stopPropagation(),0===event.button&&i.action(),a.hideWidget()}),n.append(t)}e.append(n),e.css("display","block")}addBlocks(t){if(b.isArray(t)){var e=this;w.a.each(t,function(t,a){e.addBlock(a)})}else b.isObject(t)&&this.addBlock(t)}findBlock(t){return this.instances[t]}findBlocksByType(t){}removeBlocks(t){}removeBlocksByTypes(t){}registerBlock(t,e){let a=this.registries;a[t.id]&&g.warn(`${t.type} registered repeated:  ${t.id}`);let n=xe(t.category);n&&n.state&&(t.state||(t.state={}),t.state=w.a.extend(!0,t.state,n.state)),a[t.id]=ve.createPrototype(Object.assign({type:t.type,__panel:this,state:{}},t)),a[t.id]?(e&&e[t.category].blocks.push(t.id),g.log(`${t.type} registered successed:  ${t.id}`)):g.warn(`${t.type} registered failed:  ${t.id}`)}hasRegistered(t){return!(!this.registries.hasOwnProperty(t)||!this.registries[t])}cloneBlock(t,e=!1){let a=this.instances[t];if(!a)return void g.warn(`Panel CloneBlock failed: can not find Instance [${t}]`);const n=a.cloneSelf(e),i=a.canvasPosition();n.setTranslate(i.x+64,i.y+64)}clearBlocks(){const t=this;w()(this.dom.canvas).children("g.ycBlockDraggable").each(function(){let e=w()(this);if("insertmarker"===e.attr("data-id"))return!1;let a=e.attr("data-uid");t.removeBlock(a)});for(let e of Object.keys(this.instances))g.warn(`Panel ClearBlocks: Instance [${e}] still existed`)}export(t){}save(){let t=w()(this.dom.canvas);const e=this;let a={author:"Unique",blocks:[]};return t.children("g.ycBlockDraggable").each(function(){let t=w()(this);if("insertmarker"===t.attr("data-id"))return!0;let n=t.attr("data-uid"),i=e.instances[n];a.blocks.push(i.encode())}),JSON.stringify(a)}createBlock(t){let e=this.addBlock({type:t.protoId,state:{transform:t.state.transform}});return e.decode(t),e}load(t){if(this.clearBlocks(),t&&b.isString(t)){let e=b.trimString(t);if(""!==e){let t=JSON.parse(e);if(!t)return void g.warn("Panel load failed: data corrupted -- ",e);if(!b.isArray(t.blocks)||0===t.blocks.length)return;for(let e of t.blocks)this.createBlock(e)}}}}var Be=_e;const ze={init:function(t,e){if(t)return new Be(t);e&&e("dom is invalid")}};var Ce=ze;g.setLevel("debug");var $e={name:"Scratch",props:["width","height","flex","loadbtn","savebtn","export"],data:function(){return{id:"scratch",size:{width:800,height:600},flyout:{width:250},editor:null}},computed:{flyoutBackground:function(){return`M 0,0 h ${this.flyout.width} a 0 0 0 0 1 0 0 v ${this.size.height} a 0 0 0 0 1 0 0 h ${-this.flyout.width} z`}},created:function(){void 0!=this.width&&(this.size.width=parseInt(this.width)),void 0!=this.height&&(this.size.height=parseInt(this.height))},mounted:function(){let t=this;t.editor=Ce.init(t.$el);let e=parseInt(t.flex);if(1===e){var a=function(){t.size.width=t.$el.clientWidth,t.size.height=t.$el.clientHeight};window.onresize=function(){a()},a()}let n=[];if(b.isObject(this.loadbtn))n.push({id:"load",img:this.loadbtn.img,action:this.loadbtn.action});else if(b.isFunction(this.loadbtn)){let t=this.loadbtn();n.push({id:"load",img:t.img,action:t.action})}if(b.isObject(this.savebtn))n.push({id:"save",img:this.savebtn.img,action:this.savebtn.action});else if(b.isFunction(this.savebtn)){let t=this.savebtn();n.push({id:"save",img:t.img,action:t.action})}t.editor.setOption({buttons:n,exportCallback:this.export})},methods:{}},Se=$e,He=(a("1068"),Object(H["a"])(Se,W,M,!1,null,null,null));He.options.__file="Scratch.vue";var Ne=He.exports,Ae=a("76e9"),je=a.n(Ae),Pe={data:function(){return{activeName:"script",dialogVisible:!1,form:{name:"test",ext:".yu"},dialogCallback:null}},components:{Scratch:Ne},computed:{load:function(){return{img:"/img/open.svg",action:this.selectFile}},save:function(){return{img:"/img/save.svg",action:this.openSaveDialog}}},methods:{selectFile(t){const e=document.querySelector("#yuchang-save");e.addEventListener("change",()=>{let a=t;e.value;if(0!==event.target.files.length){var n=new FileReader;n.onload=function(){a.load(this.result)},n.readAsText(event.target.files[0]),e.value=""}}).click()},openSaveDialog(t){this.form.ext=".yu",this.dialogVisible=!0,this.dialogCallback=this.saveFile.bind(this,t)},callbackSaveFile(){this.dialogVisible=!1,this.dialogCallback&&this.dialogCallback()},openExportDialog(t,e,a){this.form.ext=e,this.dialogVisible=!0,this.dialogCallback=this.exportFile.bind(this,t,a)},saveFile(t){let e=t.save(),a=new File([e],this.form.name+this.form.ext,{type:"text/plain;charset=utf-8"});je()(a)},exportFile(t,e){let a="";a=b.isObject(e)||b.isArray(e)?JSON.stringify(e):b.isString(e)?e:""+e;let n=new File([a],this.form.name+this.form.ext,{type:"text/plain;charset=utf-8"});je()(n)}},mounted:function(){}},Te=Pe,De=(a("4937"),Object(H["a"])(Te,R,E,!1,null,"7a26292c",null));De.options.__file="ScriptEditor.vue";var Ie=De.exports,Oe=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},Fe=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("i",{staticClass:"fa fa-camera-retro fa-3x"}),a("h1",[t._v("尚未实现，敬请期待")])])}],Re={data:function(){return{}},mounted:function(){}},Ee=Re,We=(a("670f"),Object(H["a"])(Ee,Oe,Fe,!1,null,"4476f74d",null));We.options.__file="Empty.vue";var Me=We.exports,Ve=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("el-row",[a("el-card",{attrs:{shadow:"hover"}},[a("span",{staticClass:"buddha-score-title"},[t._v("当前积分: ")]),a("span",{staticClass:"buddha-score"},[t._v(t._s(t.scoreSum))]),a("el-button",{staticClass:"buddha-return",attrs:{type:"primary",round:""},on:{click:t.onClickReturn}},[t._v("返回")])],1)],1),a("div",{staticClass:"buddha-row-tabs"},[a("el-tabs",{attrs:{"tab-position":"left",value:"chart"},on:{"tab-click":t.onClickTab}},[a("el-tab-pane",{attrs:{label:"统计图表",name:"chart"}},[a("div",{directives:[{name:"resize",rawName:"v-resize",value:t.onChartPieResize,expression:"onChartPieResize"}],attrs:{id:"buddha-chart-pie"}}),a("div",{directives:[{name:"resize",rawName:"v-resize",value:t.onChartResize,expression:"onChartResize"}],attrs:{id:"buddha-chart"}})]),a("el-tab-pane",{attrs:{label:"积分管理",name:"manager"}},[a("el-collapse",{attrs:{accordion:""}},[a("el-collapse-item",[a("template",{slot:"title"},[t._v("\n                            添加记录"),a("i",{staticClass:"header-icon fa fa-plus-square"})]),a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"日期"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd"},model:{value:t.form.date,callback:function(e){t.$set(t.form,"date",e)},expression:"form.date"}})],1),a("el-form-item",{attrs:{label:"操作"}},[a("el-radio-group",{model:{value:t.form.category,callback:function(e){t.$set(t.form,"category",e)},expression:"form.category"}},t._l(t.categories,function(e,n,i){return a("el-radio",{attrs:{label:n}},[t._v(t._s(e))])}))],1),a("el-form-item",{attrs:{label:"课程"}},[a("el-radio-group",{model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},t._l(t.types,function(e,n,i){return a("el-radio",{attrs:{label:n}},[t._v(t._s(e))])}))],1),a("el-form-item",{attrs:{label:"积分值"}},[a("el-input-number",{attrs:{step:10,min:1,max:1e6,"controls-position":"right"},model:{value:t.form.number,callback:function(e){t.$set(t.form,"number",e)},expression:"form.number"}})],1),a("el-form-item",{attrs:{label:"说明"}},[a("el-input",{staticStyle:{width:"60%"},attrs:{placeholder:"请输入内容"},model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onAddRecord}},[t._v("添 加")])],1)],1)],2)],1),a("el-table",{ref:"scoreTable",staticStyle:{width:"100%"},attrs:{border:"",data:t.scoreData.slice((t.currentPage-1)*t.pageSize,t.currentPage*t.pageSize),stripe:"","tooltip-effect":"dark"}},[a("el-table-column",{attrs:{prop:"date",label:"日期",sortable:"","header-align":"center",width:"180"}}),a("el-table-column",{attrs:{label:"操作类型","header-align":"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                            "+t._s(t.formatCategory(e.row.category))+"\n                        ")]}}])}),a("el-table-column",{attrs:{prop:"number",label:"积分值","header-align":"center",width:"120"}}),a("el-table-column",{attrs:{label:"课程","header-align":"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                            "+t._s(t.formatType(e.row.type))+"\n                        ")]}}])}),a("el-table-column",{attrs:{prop:"desc",label:"说明","header-align":"center"}}),a("el-table-column",{attrs:{fixed:"right","header-align":"center",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{disabled:"",size:"mini",type:"primary"},on:{click:function(a){t.handleEdit(e.$index,e.row)}}},[t._v("编辑")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){t.handleDelete(e.$index,e.row)}}},[t._v("删除")])]}}])})],1),a("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,20,50],"page-size":t.pageSize,layout:"prev, pager, next, sizes",total:t.scoreData.length},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)],1)],1)},Le=[],Ge=a("313e"),qe=a.n(Ge),Ue=a("428d"),Ye=a.n(Ue),Xe={directives:{resize:Ye.a},data:function(){return{urls:{host:"/api/score",query:"record",update:"update"},chart:null,chartPie:null,currentPage:1,pageSize:10,scoreData:[],scoreSum:0,form:{date:"",type:"1",number:1,desc:"",category:"1"},types:{1:"数学",2:"语文",3:"英语",4:"逻辑",255:"其他"},categories:{1:"奖励积分",2:"扣除积分",3:"兑换积分"}}},computed:{queryUrl:function(){return this.urls.host+"/"+this.urls.query},updateUrl:function(){return this.urls.host+"/"+this.urls.update},chartOpt:function(){let t=[];const e=Object.keys(this.types).map(e=>{return t.push({id:e,name:this.types[e],type:"line",stack:"总积分",areaStyle:{},data:[]}),this.types[e]});let a={title:{text:"积分累计趋势图"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:e},grid:{left:"10%",right:"10%",bottom:"15%"},toolbox:{show:!0,feature:{restore:{show:!0},saveAsImage:{show:!0}}},dataZoom:[{show:!0,type:"slider",y:"90%",start:0,end:100}],calculable:!0,xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value",name:"积分",axisLabel:{formatter:"{value}"}}],series:t};return a},chartPieOpt:function(){let t={title:{text:"积分活动比例",left:"left"},tooltip:{trigger:"item",formatter:"{b} : {c} ({d}%)"},legend:{bottom:10,left:"center",data:[]},series:[{name:"score",type:"pie",radius:"65%",center:["50%","50%"],selectedMode:"single",data:[],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};return t}},methods:{onChartResize(){this.chart&&this.chart.resize()},onChartPieResize(){this.chart&&this.chart.resize()},onClickTab(t){"chart"===t.name&&this.modified&&(this.refreshChart(),this.modified=!1)},onClickReturn(){this.$router.go(-1)},onAddRecord(){if(0===this.form.number)return void this.$message.error("积分值不能为0");const t=b.cloneObject(this.form);t.date&&""!==t.date||(t.date=new Date);let e=this;C.ajaxPost({url:this.updateUrl,data:{type:"add",record:t},success:a=>{if(0===a.result){let n=!1;e.scoreSum=a.content.score,t.id=a.content.id,e.scoreData.forEach((a,i)=>{let s=b.dateCompare(a.date,t.date);if(s>0)return e.scoreData.splice(i,0,t),n=!0,!1}),n||e.scoreData.push(t),e.modified=!0,e.$message("积分记录添加成功")}else e.$message.error("添加积分记录失败 -"+a.err)}})},handleCurrentChange:function(t){this.currentPage=t},handleSizeChange(t){this.pageSize=t,this.currentPage=1},handleEdit(t,e){this.$message("功能尚未实现")},handleDelete(t,e){let a=this;const n=(this.currentPage-1)*this.pageSize+t;this.$confirm("确认删除该条记录(不可恢复）?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{C.ajaxPost({url:this.updateUrl,data:{type:"delete",id:e.id},success:t=>{0===t.result?(a.scoreData.splice(n,1),a.scoreSum=t.content.score,a.modified=!0,this.$message("积分记录删除成功")):a.$message.error("删除积分记录失败 -"+t.err)}})}).catch(()=>{})},fetchRecords(){C.ajaxGet({url:this.queryUrl,success:t=>{0===t.result?(this.scoreSum=t.content.score,this.refreshChart(t.content.records)):this.$message.error("读取积分记录失败 -"+t.err)}})},refreshChart(t){t&&(this.scoreData=t);let e=b.concatArray([],this.scoreData.map(t=>{return t.date}));const a={};for(let[o,r]of Object.entries(this.categories))a[o]={value:0,name:r};const n={},i={},s=Object.keys(this.types).map(t=>{return n[t]=0,i[t]=new Array(e.length),{id:t,name:this.types[t],data:i[t]}});this.scoreData.forEach(t=>{let s=e.indexOf(t.date),o=Number(t.number);"1"!==t.category&&(o=0-o),a[t.category].value+=t.number,n[t.type]+=o;for(let e of Object.keys(this.types))i[e][s]=n[e]}),this.chart.setOption({xAxis:{data:e},series:s}),this.chartPie.setOption({series:[{name:"score",data:Object.values(a)}]})},formatCategory(t){return this.categories[t]},formatType(t){return this.types[t]}},mounted:function(){this.form.date=b.currentTimeString(),this.chart=qe.a.init(document.querySelector("#buddha-chart")),this.chart.setOption(this.chartOpt),this.chartPie=qe.a.init(document.querySelector("#buddha-chart-pie")),this.chartPie.setOption(this.chartPieOpt),this.fetchRecords()}},Ze=Xe,Je=(a("d0e2"),Object(H["a"])(Ze,Ve,Le,!1,null,"97310270",null));Je.options.__file="Score.vue";var Qe=Je.exports,Ke=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("el-card",{attrs:{shadow:"hover"}},[a("span",{staticClass:"buddha-score-title"},[t._v("当前积分: ")]),a("span",{staticClass:"buddha-score"},[t._v(t._s(t.scoreSum))]),a("el-button",{staticClass:"buddha-return",attrs:{type:"primary",round:""},on:{click:t.onClickReturn}},[t._v("返回")])],1),a("div",{staticClass:"buddha-row-tabs"},[a("div",{directives:[{name:"resize",rawName:"v-resize",value:t.onChartPieResize,expression:"onChartPieResize"}],attrs:{id:"buddha-chart-pie"}}),a("el-table",{ref:"scoreTable",staticStyle:{width:"100%"},attrs:{border:"",data:t.scoreData.slice((t.currentPage-1)*t.pageSize,t.currentPage*t.pageSize),stripe:"","tooltip-effect":"dark"}},[a("el-table-column",{attrs:{prop:"date",label:"日期",sortable:"","header-align":"center",width:"180"}}),a("el-table-column",{attrs:{label:"操作类型","header-align":"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t.formatCategory(e.row.category))+"\n                ")]}}])}),a("el-table-column",{attrs:{prop:"number",label:"积分值","header-align":"center",width:"120"}}),a("el-table-column",{attrs:{label:"课程","header-align":"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t.formatType(e.row.type))+"\n                ")]}}])}),a("el-table-column",{attrs:{prop:"desc",label:"说明","header-align":"center"}})],1),a("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-sizes":[10,20,50],"page-size":t.pageSize,layout:"prev, pager, next, sizes",total:t.scoreData.length},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)},ta=[],ea={directives:{resize:Ye.a},data:function(){return{urls:{host:"/api/score",query:"record"},chartPie:null,currentPage:1,pageSize:10,scoreData:[],scoreSum:0,types:{1:"数学",2:"语文",3:"英语",4:"逻辑",255:"其他"},categories:{1:"奖励积分",2:"扣除积分",3:"兑换积分"}}},computed:{queryUrl:function(){return this.urls.host+"/"+this.urls.query},chartPieOpt:function(){let t={title:{text:"积分活动比例",left:"left"},tooltip:{trigger:"item",formatter:"{b} : {c} ({d}%)"},legend:{bottom:10,left:"center",data:[]},series:[{name:"score",type:"pie",radius:"65%",center:["50%","50%"],selectedMode:"single",data:[],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};return t}},methods:{onChartPieResize(){this.chart&&this.chart.resize()},onClickReturn(){this.$router.go(-1)},handleCurrentChange:function(t){this.currentPage=t},handleSizeChange(t){this.pageSize=t,this.currentPage=1},fetchRecords(){C.ajaxGet({url:this.queryUrl,success:t=>{0===t.result?(this.scoreSum=t.content.score,this.refreshChart(t.content.records)):this.$message.error("读取积分记录失败 -"+t.err)}})},refreshChart(t){t&&(this.scoreData=t);let e=new Array(t.length);const a={};for(let[n,i]of Object.entries(this.categories))a[n]={value:0,name:i};t.forEach((t,n)=>{e[n]=t.date,a[t.category].value+=t.number}),this.chartPie.setOption({series:[{name:"score",data:Object.values(a)}]})},formatCategory(t){return this.categories[t]},formatType(t){return this.types[t]}},mounted:function(){this.chartPie=qe.a.init(document.querySelector("#buddha-chart-pie")),this.chartPie.setOption(this.chartPieOpt),this.fetchRecords()}},aa=ea,na=(a("f8a1"),Object(H["a"])(aa,Ke,ta,!1,null,"7166f5b8",null));na.options.__file="Mine.vue";var ia=na.exports;n["default"].use(j["a"]);const sa=[{path:"/empty",name:"empty",component:Me},{path:"/",name:"welcome",component:F},{path:"/mine",name:"mine",component:ia},{path:"/score",name:"score",component:Qe},{path:"/editor",name:"editor",component:Ie}];var oa=new j["a"]({routes:sa}),ra=a("2f62");n["default"].use(ra["a"]);var la=new ra["a"].Store({state:{appName:"",version:"",subVersion:"",company:""},getters:{appTitle(t){return`${t.appName} V${t.version}`}},mutations:{updateManifest(t,e){t.appName=e.appName,t.version=e.version,t.subVersion=e.subVersion,t.company=e.company}},actions:{}});n["default"].config.productionTip=!1,n["default"].use(s.a),new n["default"]({router:oa,store:la,render:t=>t(A)}).$mount("#app")},"5c0b":function(t,e,a){"use strict";var n=a("2856"),i=a.n(n);i.a},6:function(t,e){},"670f":function(t,e,a){"use strict";var n=a("27c5"),i=a.n(n);i.a},7:function(t,e){},8:function(t,e){},9:function(t,e){},"9a9e":function(t,e,a){"use strict";var n=a("0298"),i=a.n(n);i.a},cf05:function(t,e,a){t.exports=a.p+"img/logo.82b9c7a5.png"},d0e2:function(t,e,a){"use strict";var n=a("f74a"),i=a.n(n);i.a},dd4f:function(t,e,a){},f74a:function(t,e,a){},f8a1:function(t,e,a){"use strict";var n=a("3c8b"),i=a.n(n);i.a}});
//# sourceMappingURL=app.43b2f03f.js.map